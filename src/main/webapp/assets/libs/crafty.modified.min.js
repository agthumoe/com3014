
(function e(b,h,f){function d(n,k){if(!h[n]){if(!b[n]){var j=typeof require=="function"&&require;if(!k&&j){return j(n,!0)}if(a){return a(n,!0)}var m=new Error("Cannot find module '"+n+"'");throw m.code="MODULE_NOT_FOUND",m}var i=h[n]={exports:{}};b[n][0].call(i.exports,function(l){var o=b[n][1][l];return d(o?o:l)},i,i.exports,e,b,h,f)}return h[n].exports}var a=typeof require=="function"&&require;for(var g=0;g<f.length;g++){d(f[g])}return d})({1:[function(d,b,g){var a=b.exports={};var h=[];var l=false;var i;var j=-1;function k(){l=false;if(i.length){h=i.concat(h)}else{j=-1}if(h.length){n()}}function n(){if(l){return}var p=setTimeout(k);l=true;var o=h.length;while(o){i=h;h=[];while(++j<o){if(i){i[j].run()}}j=-1;o=h.length}i=null;l=false;clearTimeout(p)}a.nextTick=function(o){var p=new Array(arguments.length-1);if(arguments.length>1){for(var q=1;q<arguments.length;q++){p[q-1]=arguments[q]}}h.push(new f(o,p));if(h.length===1&&!l){setTimeout(n,0)}};function f(o,p){this.fun=o;this.array=p}f.prototype.run=function(){this.fun.apply(null,this.array)};a.title="browser";a.browser=true;a.env={};a.argv=[];a.version="";a.versions={};function m(){}a.on=m;a.addListener=m;a.once=m;a.off=m;a.removeListener=m;a.removeAllListeners=m;a.emit=m;a.binding=function(o){throw new Error("process.binding is not supported")};a.cwd=function(){return"/"};a.chdir=function(o){throw new Error("process.chdir is not supported")};a.umask=function(){return 0}},{}],2:[function(b,d,a){var f=b("../core/core.js");f.c("Draggable",{_origX:null,_origY:null,_oldX:null,_oldY:null,_dir:null,init:function(){this.requires("MouseDrag");this.bind("StartDrag",this._startDrag).bind("Dragging",this._drag)},remove:function(){this.unbind("StartDrag",this._startDrag).unbind("Dragging",this._drag)},enableDrag:function(){this.uniqueBind("Dragging",this._drag);return this},disableDrag:function(){this.unbind("Dragging",this._drag);return this},dragDirection:function(g){if(typeof g==="undefined"){this._dir=null}else{if((""+parseInt(g,10))==g){this._dir={x:Math.cos(g/180*Math.PI),y:Math.sin(g/180*Math.PI)}}else{if(g.x===0&&g.y===0){this._dir={x:0,y:0}}else{var h=Math.sqrt(g.x*g.x+g.y*g.y);this._dir={x:g.x/h,y:g.y/h}}}}return this},_startDrag:function(g){this._origX=g.realX;this._origY=g.realY;this._oldX=this._x;this._oldY=this._y},_drag:function(h){if(this._dir){if(this._dir.x!==0||this._dir.y!==0){var g=(h.realX-this._origX)*this._dir.x+(h.realY-this._origY)*this._dir.y;this.x=this._oldX+g*this._dir.x;this.y=this._oldY+g*this._dir.y}}else{this.x=this._oldX+(h.realX-this._origX);this.y=this._oldY+(h.realY-this._origY)}}});f.c("Multiway",{_speed:null,init:function(){this.requires("Motion, Keyboard");this._keyDirection={};this._activeDirections={};this._directionSpeed={};this._speed={x:150,y:150};this.bind("KeyDown",this._keydown).bind("KeyUp",this._keyup)},remove:function(){this.unbind("KeyDown",this._keydown).unbind("KeyUp",this._keyup);this.__unapplyActiveDirections()},_keydown:function(h){var g=this._keyDirection[h.key];if(g!==undefined){if(this._activeDirections[g]===0&&!this.disableControls){this.vx+=this._directionSpeed[g].x;this.vy+=this._directionSpeed[g].y}this._activeDirections[g]++}},_keyup:function(h){var g=this._keyDirection[h.key];if(g!==undefined){this._activeDirections[g]--;if(this._activeDirections[g]===0&&!this.disableControls){this.vx-=this._directionSpeed[g].x;this.vy-=this._directionSpeed[g].y}}},multiway:function(h,g){if(g){if(h.x!==undefined&&h.y!==undefined){this._speed.x=h.x;this._speed.y=h.y}else{this._speed.x=h;this._speed.y=h}}else{g=h}if(!this.disableControls){this.__unapplyActiveDirections()}this._updateKeys(g);this._updateSpeed(this._speed);if(!this.disableControls){this.__applyActiveDirections()}return this},speed:function(g){if(!this.disableControls){this.__unapplyActiveDirections()}this._updateSpeed(g);if(!this.disableControls){this.__applyActiveDirections()}return this},_updateKeys:function(h){this._keyDirection={};this._activeDirections={};for(var g in h){var j=f.keys[g]||g;var i=this._keyDirection[j]=h[g];this._activeDirections[i]=this._activeDirections[i]||0;if(this.isDown(j)){this._activeDirections[i]++}}},_updateSpeed:function(g){this._directionSpeed={};var i;for(var h in this._keyDirection){i=this._keyDirection[h];this._directionSpeed[i]={x:Math.round(Math.cos(i*(Math.PI/180))*1000*g.x)/1000,y:Math.round(Math.sin(i*(Math.PI/180))*1000*g.y)/1000}}},__applyActiveDirections:function(){for(var g in this._activeDirections){if(this._activeDirections[g]>0){this.vx+=this._directionSpeed[g].x;this.vy+=this._directionSpeed[g].y}}},__unapplyActiveDirections:function(){for(var g in this._activeDirections){if(this._activeDirections[g]>0){this.vx-=this._directionSpeed[g].x;this.vy-=this._directionSpeed[g].y}}},enableControl:function(){if(this.disableControls){this.__applyActiveDirections()}this.disableControls=false;return this},disableControl:function(){if(!this.disableControls){this.__unapplyActiveDirections()}this.disableControls=true;return this}});f.c("Jumper",{_jumpSpeed:300,canJump:true,init:function(){this.requires("Supportable, Motion, Keyboard");this.enableControl=this.enableControl||function(){this.disableControls=false};this.disableControl=this.disableControl||function(){this.disableControls=true}},remove:function(){this.unbind("KeyDown",this._keydown_jumper)},_keydown_jumper:function(h){if(this.disableControls){return}if(this._jumpKeys[h.key]){var g=this.ground;this.canJump=!!g;this.trigger("CheckJumping",g);if(this.canJump){this.vy=-this._jumpSpeed}}},jumper:function(k,g){if(g){this._jumpSpeed=k}else{g=k}this._jumpKeys={};for(var j=0;j<g.length;++j){var h=g[j];var l=f.keys[h]||h;this._jumpKeys[l]=true}this.uniqueBind("KeyDown",this._keydown_jumper);return this},jumpSpeed:function(g){this._jumpSpeed=g;return this}});f.c("Fourway",{init:function(){this.requires("Multiway")},fourway:function(g){this.multiway(g||this._speed,{UP_ARROW:-90,DOWN_ARROW:90,RIGHT_ARROW:0,LEFT_ARROW:180,W:-90,S:90,D:0,A:180,Z:-90,Q:180});return this}});f.c("Twoway",{init:function(){this.requires("Multiway, Jumper")},twoway:function(h,g){this.multiway(h||this._speed,{RIGHT_ARROW:0,LEFT_ARROW:180,D:0,A:180,Q:180});this.jumper(g||h*2||this._jumpSpeed,[f.keys.UP_ARROW,f.keys.W,f.keys.Z]);return this}})},{"../core/core.js":7}],3:[function(b,d,a){var f=b("../core/core.js");f.extend({device:{_deviceOrientationCallback:false,_deviceMotionCallback:false,_normalizeDeviceOrientation:function(g){var h;if(window.DeviceOrientationEvent){h={tiltLR:g.gamma,tiltFB:g.beta,dir:g.alpha,motUD:null}}else{if(window.OrientationEvent){h={tiltLR:g.x*90,tiltFB:g.y*-90,dir:null,motUD:g.z}}}f.device._deviceOrientationCallback(h)},_normalizeDeviceMotion:function(h){var g=h.accelerationIncludingGravity,j=(g.z>0)?+1:-1;var i={acceleration:g,rawAcceleration:"["+Math.round(g.x)+", "+Math.round(g.y)+", "+Math.round(g.z)+"]",facingUp:j,tiltLR:Math.round(((g.x)/9.81)*-90),tiltFB:Math.round(((g.y+9.81)/9.81)*90*j)};f.device._deviceMotionCallback(i)},deviceOrientation:function(g){this._deviceOrientationCallback=g;if(f.support.deviceorientation){if(window.DeviceOrientationEvent){f.addEvent(this,window,"deviceorientation",this._normalizeDeviceOrientation)}else{if(window.OrientationEvent){f.addEvent(this,window,"MozOrientation",this._normalizeDeviceOrientation)}}}},deviceMotion:function(g){this._deviceMotionCallback=g;if(f.support.devicemotion){if(window.DeviceMotionEvent){f.addEvent(this,window,"devicemotion",this._normalizeDeviceMotion)}}}}})},{"../core/core.js":7}],4:[function(d,f,b){var g=d("../core/core.js"),a=window.document;g.extend({over:null,mouseObjs:0,mousePos:{},lastEvent:null,touchObjs:0,selected:false,keydown:{},detectBlur:function(i){var h=((i.clientX>g.stage.x&&i.clientX<g.stage.x+g.viewport.width)&&(i.clientY>g.stage.y&&i.clientY<g.stage.y+g.viewport.height));if(!g.selected&&h){g.trigger("CraftyFocus")}if(g.selected&&!h){g.trigger("CraftyBlur")}g.selected=h},multitouch:function(h){if(typeof h!=="boolean"){return this._touchHandler.multitouch}this._touchHandler.multitouch=h},resetKeyDown:function(){for(var h in g.keys){if(g.keydown[g.keys[h]]){this.trigger("KeyUp",{key:g.keys[h]})}}g.keydown={}},mouseDispatch:function(o){if(!g.mouseObjs){return}g.lastEvent=o;var p=-1,n=o.target?o.target:o.srcElement,j,h,m=0,k,t=g.domHelper.translate(o.clientX,o.clientY),u,s,v={},r=o.type;if(typeof o.which==="undefined"){o.mouseButton=(o.button<2)?g.mouseButtons.LEFT:((o.button==4)?g.mouseButtons.MIDDLE:g.mouseButtons.RIGHT)}else{o.mouseButton=(o.which<2)?g.mouseButtons.LEFT:((o.which==2)?g.mouseButtons.MIDDLE:g.mouseButtons.RIGHT)}o.realX=u=g.mousePos.x=t.x;o.realY=s=g.mousePos.y=t.y;j=g.findClosestEntityByComponent("Mouse",u,s,n);if(j){if(r==="mousedown"){j.trigger("MouseDown",o)}else{if(r==="mouseup"){j.trigger("MouseUp",o)}else{if(r=="dblclick"){j.trigger("DoubleClick",o)}else{if(r=="click"){j.trigger("Click",o)}else{if(r==="mousemove"){j.trigger("MouseMove",o);if(this.over!==j){if(this.over){this.over.trigger("MouseOut",o);this.over=null}this.over=j;j.trigger("MouseOver",o)}}else{j.trigger(r,o)}}}}}}else{if(r==="mousemove"&&this.over){this.over.trigger("MouseOut",o);this.over=null}if(r==="mousedown"){g.viewport.mouselook("start",o)}else{if(r==="mousemove"){g.viewport.mouselook("drag",o)}else{if(r=="mouseup"){g.viewport.mouselook("stop")}}}}if(r==="mousemove"){this.lastEvent=o}},touchDispatch:function(h){if(!g.touchObjs&&!g.mouseObjs){return}if(this._touchHandler.multitouch){switch(h.type){case"touchstart":this._touchHandler.handleStart(h);break;case"touchmove":this._touchHandler.handleMove(h);break;case"touchleave":case"touchcancel":case"touchend":this._touchHandler.handleEnd(h);break}}else{this._touchHandler.mimicMouse(h)}if(h.target&&h.target.nodeName!=="INPUT"&&h.target.nodeName!=="TEXTAREA"){if(h.preventDefault){h.preventDefault()}else{h.returnValue=false}}},_touchHandler:{fingers:[],multitouch:false,handleStart:function(p){var n=p.changedTouches;for(var m=0,j=n.length;m<j;m++){var t=false,r=g.domHelper.translate(n[m].clientX,n[m].clientY),o=p.target?p.target:p.srcElement,s,q,h;n[m].realX=s=r.x;n[m].realY=q=r.y;h=this.findClosestTouchEntity(s,q,o);if(h){h.trigger("TouchStart",n[m]);t=this.fingerDownIndexByEntity(h)}var k=this.setTouch(n[m],h);if(t!==false&&t>=0){this.fingers[t]=k}else{this.fingers.push(k)}}},handleMove:function(o){var m=o.changedTouches;for(var k=0,j=m.length;k<j;k++){var s=this.fingerDownIndexById(m[k].identifier),q=g.domHelper.translate(m[k].clientX,m[k].clientY),n=o.target?o.target:o.srcElement,r,p,h;m[k].realX=r=q.x;m[k].realY=p=q.y;h=this.findClosestTouchEntity(r,p,n);if(s>=0){if(typeof this.fingers[s].entity!=="undefined"){if(this.fingers[s].entity==h){this.fingers[s].entity.trigger("TouchMove",m[k])}else{if(typeof h==="object"){h.trigger("TouchStart",m[k])}this.fingers[s].entity.trigger("TouchEnd")}}this.fingers[s].entity=h;this.fingers[s].realX=r;this.fingers[s].realY=p}}},handleEnd:function(o){var n=o.changedTouches,k=o.type=="touchcancel"?"TouchCancel":"TouchEnd";for(var m=0,j=n.length;m<j;m++){var h=this.fingerDownIndexById(n[m].identifier);if(h>=0){if(this.fingers[h].entity){this.fingers[h].entity.trigger(k)}this.fingers.splice(h,1)}}},setTouch:function(i,h){return{identifier:i.identifier,realX:i.realX,realY:i.realY,entity:h}},findClosestTouchEntity:function(i,j,h){return g.findClosestEntityByComponent("Touch",i,j,h)},fingerDownIndexById:function(k){for(var j=0,h=this.fingers.length;j<h;j++){var m=this.fingers[j].identifier;if(m==k){return j}}return -1},fingerDownIndexByEntity:function(m){for(var j=0,h=this.fingers.length;j<h;j++){var k=this.fingers[j].entity;if(k==m){return j}}return -1},mimicMouse:function(k){var i,h=g.lastEvent;if(k.type==="touchstart"){i="mousedown"}else{if(k.type==="touchmove"){i="mousemove"}else{if(k.type==="touchend"){i="mouseup"}else{if(k.type==="touchcancel"){i="mouseup"}else{if(k.type==="touchleave"){i="mouseup"}}}}}if(k.touches&&k.touches.length){first=k.touches[0]}else{if(k.changedTouches&&k.changedTouches.length){first=k.changedTouches[0]}}var j=a.createEvent("MouseEvent");j.initMouseEvent(i,true,true,window,1,first.screenX,first.screenY,first.clientX,first.clientY,false,false,false,false,0,k.relatedTarget);first.target.dispatchEvent(j);if(h!==null&&h.type=="mousedown"&&i=="mouseup"){i="click";j=a.createEvent("MouseEvent");j.initMouseEvent(i,true,true,window,1,first.screenX,first.screenY,first.clientX,first.clientY,false,false,false,false,0,k.relatedTarget);first.target.dispatchEvent(j)}},},findClosestEntityByComponent:function(n,w,v,s){var o=s?s:g.stage.elem,j,h,k,m=0,r=-1,z={};if(o.nodeName!="CANVAS"){while(typeof(o.id)!="string"&&o.id.indexOf("ent")==-1){o=o.parentNode}var u=g(parseInt(o.id.replace("ent",""),10));if(u.__c[n]&&u.isAt(w,v)){j=u}}if(!j){h=g.map.search({_x:w,_y:v,_w:1,_h:1},false);for(k=h.length;m<k;++m){if(!h[m].__c[n]||!h[m]._visible){continue}var p=h[m],t=false;if(z[p[0]]){continue}else{z[p[0]]=true}if(p.mapArea){if(p.mapArea.containsPoint(w,v)){t=true}}else{if(p.isAt(w,v)){t=true}}if(t&&(p._z>=r||r===-1)){if(p._z===r&&p[0]<j[0]){continue}r=p._z;j=p}}}return j},mouseWheelDispatch:function(h){h.direction=(h.detail<0||h.wheelDelta>0)?1:-1;g.trigger("MouseWheelScroll",h)},keyboardDispatch:function(l){var j=l,n={},k="char charCode keyCode type shiftKey ctrlKey metaKey timestamp".split(" ");for(var h=k.length;h;){var m=k[--h];n[m]=j[m]}n.which=j.charCode!==null?j.charCode:j.keyCode;n.key=j.keyCode||j.which;n.originalEvent=j;l=n;if(l.type==="keydown"){if(g.keydown[l.key]!==true){g.keydown[l.key]=true;g.trigger("KeyDown",l)}}else{if(l.type==="keyup"){delete g.keydown[l.key];g.trigger("KeyUp",l)}}if(g.selected&&!(l.key==8||l.key>=112&&l.key<=135)){if(j.stopPropagation){j.stopPropagation()}else{j.cancelBubble=true}if(j.target&&j.target.nodeName!=="INPUT"&&j.target.nodeName!=="TEXTAREA"){if(j.preventDefault){j.preventDefault()}else{j.returnValue=false}}return false}}});g._preBind("Load",function(){g.addEvent(this,"keydown",g.keyboardDispatch);g.addEvent(this,"keyup",g.keyboardDispatch);g.addEvent(this,g.stage.elem,"mousedown",g.mouseDispatch);g.addEvent(this,g.stage.elem,"mouseup",g.mouseDispatch);g.addEvent(this,a.body,"mouseup",g.detectBlur);g.addEvent(this,window,"blur",g.resetKeyDown);g.addEvent(this,g.stage.elem,"mousemove",g.mouseDispatch);g.addEvent(this,g.stage.elem,"click",g.mouseDispatch);g.addEvent(this,g.stage.elem,"dblclick",g.mouseDispatch);g.addEvent(this,g.stage.elem,"touchstart",g.touchDispatch);g.addEvent(this,g.stage.elem,"touchmove",g.touchDispatch);g.addEvent(this,g.stage.elem,"touchend",g.touchDispatch);g.addEvent(this,g.stage.elem,"touchcancel",g.touchDispatch);g.addEvent(this,g.stage.elem,"touchleave",g.touchDispatch);if(g.support.prefix==="Moz"){g.addEvent(this,g.stage.elem,"DOMMouseScroll",g.mouseWheelDispatch)}else{g.addEvent(this,g.stage.elem,"mousewheel",g.mouseWheelDispatch)}});g._preBind("CraftyStop",function(){g.removeEvent(this,"keydown",g.keyboardDispatch);g.removeEvent(this,"keyup",g.keyboardDispatch);if(g.stage){g.removeEvent(this,g.stage.elem,"mousedown",g.mouseDispatch);g.removeEvent(this,g.stage.elem,"mouseup",g.mouseDispatch);g.removeEvent(this,g.stage.elem,"mousemove",g.mouseDispatch);g.removeEvent(this,g.stage.elem,"click",g.mouseDispatch);g.removeEvent(this,g.stage.elem,"dblclick",g.mouseDispatch);g.removeEvent(this,g.stage.elem,"touchstart",g.touchDispatch);g.removeEvent(this,g.stage.elem,"touchmove",g.touchDispatch);g.removeEvent(this,g.stage.elem,"touchend",g.touchDispatch);g.removeEvent(this,g.stage.elem,"touchcancel",g.touchDispatch);g.removeEvent(this,g.stage.elem,"touchleave",g.touchDispatch);if(g.support.prefix==="Moz"){g.removeEvent(this,g.stage.elem,"DOMMouseScroll",g.mouseWheelDispatch)}else{g.removeEvent(this,g.stage.elem,"mousewheel",g.mouseWheelDispatch)}}g.removeEvent(this,a.body,"mouseup",g.detectBlur);g.removeEvent(this,window,"blur",g.resetKeyDown)});g.c("Mouse",{init:function(){g.mouseObjs++;this.requires("AreaMap").bind("Remove",function(){g.mouseObjs--})}});g.c("Touch",{init:function(){g.touchObjs++;this.requires("AreaMap").bind("Remove",function(){g.touchObjs--})}});g.c("AreaMap",{init:function(){},areaMap:function(i){if(arguments.length>1){var h=Array.prototype.slice.call(arguments,0);i=new g.polygon(h)}else{if(i.constructor===Array){i=new g.polygon(i.slice())}else{i=i.clone()}}i.shift(this._x,this._y);this.mapArea=i;this.attach(this.mapArea);this.trigger("NewAreaMap",i);return this}});g.c("Button",{init:function(){var h=(!g.mobile||(g.mobile&&!g.multitouch()))?"Mouse":"Touch";this.requires(h)}});g.c("MouseDrag",{_dragging:false,init:function(){this.requires("Mouse");this.bind("MouseDown",this._ondown)},remove:function(){this.unbind("MouseDown",this._ondown)},_ondown:function(h){if(h.mouseButton!==g.mouseButtons.LEFT){return}this.startDrag(h)},_ondrag:function(h){if(!this._dragging||h.realX===0||h.realY===0){return false}this.trigger("Dragging",h)},_onup:function(h){if(h.mouseButton!==g.mouseButtons.LEFT){return}this.stopDrag(h)},startDrag:function(h){if(this._dragging){return}this._dragging=true;g.addEvent(this,g.stage.elem,"mousemove",this._ondrag);g.addEvent(this,g.stage.elem,"mouseup",this._onup);this.trigger("StartDrag",h||g.lastEvent);return this},stopDrag:function(h){if(!this._dragging){return}this._dragging=false;g.removeEvent(this,g.stage.elem,"mousemove",this._ondrag);g.removeEvent(this,g.stage.elem,"mouseup",this._onup);this.trigger("StopDrag",h||g.lastEvent);return this}});g.c("Keyboard",{isDown:function(h){if(typeof h==="string"){h=g.keys[h]}return !!g.keydown[h]}})},{"../core/core.js":7}],5:[function(b,d,a){var f=b("../core/core.js");f.extend({keys:{BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,"0":48,"1":49,"2":50,"3":51,"4":52,"5":53,"6":54,"7":55,"8":56,"9":57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,PULT_UP:29460,PULT_DOWN:29461,PULT_LEFT:4,PULT_RIGHT:5},mouseButtons:{LEFT:0,MIDDLE:1,RIGHT:2}})},{"../core/core.js":7}],6:[function(b,d,a){var f=function(h,g){this.timePerFrame=1000/Crafty.timer.FPS();this.duration=h;if(typeof g==="function"){this.easing_function=g}else{if(typeof g==="string"&&this.standardEasingFunctions[g]){this.easing_function=this.standardEasingFunctions[g]}else{this.easing_function=this.standardEasingFunctions.linear}}this.reset()};f.prototype={duration:0,clock:0,steps:null,complete:false,paused:false,reset:function(){this.loops=1;this.clock=0;this.complete=false;this.paused=false},repeat:function(g){this.loops=g},setProgress:function(h,g){this.clock=this.duration*h;if(typeof g!=="undefined"){this.loops=g}},pause:function(){this.paused=true},resume:function(){this.paused=false;this.complete=false},tick:function(g){if(this.paused||this.complete){return}this.clock+=g;this.frames=Math.floor(this.clock/this.timePerFrame);while(this.clock>=this.duration&&this.complete===false){this.loops--;if(this.loops>0){this.clock-=this.duration}else{this.complete=true}}},time:function(){return(Math.min(this.clock/this.duration,1))},value:function(){return this.easing_function(this.time())},standardEasingFunctions:{linear:function(g){return g},smoothStep:function(g){return(3-2*g)*g*g},smootherStep:function(g){return(6*g*g-15*g+10)*g*g*g},easeInQuad:function(g){return g*g},easeOutQuad:function(g){return g*(2-g)},easeInOutQuad:function(g){return g<0.5?2*g*g:(4-2*g)*g-1}}};d.exports=f},{}],7:[function(h,a,s){var g=h("./version");var n=function(u){return new n.fn.init(u)};var t,k,j,b,l,o,m,d,p,f;j={};m=Array.prototype.slice;d=/\s*,\s*/;p=/\s+/;var r=function(){t=1;k=0;b={};l={};o=[]};r();n.fn=n.prototype={init:function(y){if(typeof y==="string"){var w=0,C,D,B=false,A=false,E,u,v,z,x;if(y==="*"){z=0;for(C in b){this[z]=+C;z++}this.length=z;if(z===1){return b[this[0]]}return this}if(y.indexOf(",")!==-1){A=true;E=d}else{if(y.indexOf(" ")!==-1){B=true;E=p}}for(C in b){if(!b.hasOwnProperty(C)){continue}D=b[C];if(B||A){u=y.split(E);z=0;x=u.length;v=0;for(;z<x;z++){if(D.__c[u[z]]){v++}}if(B&&v===x||A&&v>0){this[w++]=+C}}else{if(D.__c[y]){this[w++]=+C}}}if(w>0&&!B&&!A){this.extend(j[y])}if(u&&B){for(z=0;z<x;z++){this.extend(j[u[z]])}}this.length=w;if(w===1){return b[this[w-1]]}}else{if(!y){y=0;if(!(y in b)){b[y]=this}}if(!(y in b)){this.length=0;return this}this[0]=y;this.length=1;if(!this.__c){this.__c={}}if(!this._callbacks){n._addCallbackMethods(this)}if(!b[y]){b[y]=this}return b[y]}n._addCallbackMethods(this);return this},setName:function(u){var v=String(u);this._entityName=v;this.trigger("NewEntityName",v);return this},addComponent:function(A){var z,v,y=0;if(arguments.length===1&&A.indexOf(",")!==-1){z=A.split(d)}else{z=arguments}for(;y<z.length;y++){if(this.__c[z[y]]===true){continue}this.__c[z[y]]=true;v=j[z[y]];this.extend(v);if(v&&"required" in v){this.requires(v.required)}if(v&&"init" in v){v.init.call(this)}if(v&&"events" in v){var x=v.events;for(var u in x){var w=typeof x[u]==="function"?x[u]:v[x[u]];this.bind(u,w)}}}this.trigger("NewComponent",z);return this},toggleComponent:function(u){var w=0,v,x;if(arguments.length>1){v=arguments.length;for(;w<v;w++){if(this.has(arguments[w])){this.removeComponent(arguments[w])}else{this.addComponent(arguments[w])}}}else{if(u.indexOf(",")!==-1){x=u.split(d);v=x.length;for(;w<v;w++){if(this.has(x[w])){this.removeComponent(x[w])}else{this.addComponent(x[w])}}}else{if(this.has(u)){this.removeComponent(u)}else{this.addComponent(u)}}}return this},requires:function(u){return this.addComponent(u)},removeComponent:function(A,w){var v=j[A];this.trigger("RemoveComponent",A);if(v&&"events" in v){var z=v.events;for(var u in z){var x=typeof z[u]==="function"?z[u]:v[z[u]];this.unbind(u,x)}}if(v&&"remove" in v){v.remove.call(this,false)}if(w===false&&v){for(var y in v){delete this[y]}}delete this.__c[A];return this},getId:function(){return this[0]},has:function(u){return !!this.__c[u]},attr:function(w,x,u,v){if(arguments.length===1&&typeof arguments[0]==="string"){return this._attr_get(w)}else{return this._attr_set(w,x,u,v)}},_attr_get:function(w,v){var y,x,u;if(typeof v==="undefined"||v===null){v=this}if(w.indexOf(".")>-1){x=w.split(".");y=x.shift();u=x.join(".");return this._attr_get(x.join("."),v[y])}else{return v[w]}},_attr_set:function(){var w,u,v;if(typeof arguments[0]==="string"){w=this._set_create_object(arguments[0],arguments[1]);u=!!arguments[2];v=arguments[3]||arguments[0].indexOf(".")>-1}else{w=arguments[0];u=!!arguments[1];v=!!arguments[2]}if(!u){this.trigger("Change",w)}if(v){this._recursive_extend(w,this)}else{this.extend.call(this,w)}return this},_set_create_object:function(v,y){var x={},w,z,u;if(v.indexOf(".")>-1){w=v.split(".");z=w.shift();u=w.join(".");x[z]=this._set_create_object(u,y)}else{x[v]=y}return x},_recursive_extend:function(u,w){var v;for(v in u){if(u[v].constructor===Object){w[v]=this._recursive_extend(u[v],w[v])}else{w[v]=u[v]}}return w},toArray:function(){return m.call(this,0)},timeout:function(v,u){this.each(function(){var w=this;setTimeout(function(){v.call(w)},u)});return this},bind:function(v,x){if(this.length===1){this._bindCallback(v,x)}else{for(var u=0;u<this.length;u++){var w=b[this[u]];if(w){w._bindCallback(v,x)}}}return this},uniqueBind:function(u,v){this.unbind(u,v);this.bind(u,v)},one:function(w,x){var v=this;var u=function(y){x.call(v,y);v.unbind(w,u)};return v.bind(w,u)},unbind:function(v,x){var u,w;for(u=0;u<this.length;u++){w=b[this[u]];if(w){w._unbindCallbacks(v,x)}}return this},trigger:function(v,w){if(this.length===1){this._runCallbacks(v,w)}else{for(var u=0;u<this.length;u++){var x=b[this[u]];if(x){x._runCallbacks(v,w)}}}return this},each:function(w){var v=0,u=this.length;for(;v<u;v++){if(!b[this[v]]){continue}w.call(b[this[v]],v)}return this},get:function(w){var v=this.length;if(typeof w!=="undefined"){if(w>=v||w+v<0){return undefined}if(w>=0){return b[this[w]]}else{return b[this[w+v]]}}else{var x=0,u=[];for(;x<v;x++){if(!b[this[x]]){continue}u.push(b[this[x]])}return u}},clone:function(){var x=this.__c,u,w,v=n.e();for(u in x){v.addComponent(u)}for(w in this){if(w!="0"&&w!="_global"&&w!="_changed"&&typeof this[w]!="function"&&typeof this[w]!="object"){v[w]=this[w]}}return v},setter:function(v,u){return this.defineField(v,function(){},u)},defineField:function(w,v,u){n.defineField(this,w,v,u);return this},destroy:function(){this.each(function(){var u;this.trigger("Remove");for(var v in this.__c){u=j[v];if(u&&"remove" in u){u.remove.call(this,true)}}this._unbindAll();delete b[this[0]]})}};n.fn.init.prototype=n.fn;n.extend=n.fn.extend=function(w){var v=this,u;if(!w){return v}for(u in w){if(v===w[u]){continue}v[u]=w[u]}return v};n._callbackMethods={_bindCallback:function(w,u){var v=this._callbacks[w];if(!v){v=this._callbacks[w]=(l[w]||(l[w]={}))[this[0]]=[];v.context=this;v.depth=0}v.push(u)},_runCallbacks:function(x,y){if(!this._callbacks[x]){return}var w=this._callbacks[x];var v,u=w.length;w.depth++;for(v=0;v<u;v++){if(typeof w[v]==="undefined"){if(w.depth<=1){w.splice(v,1);v--;u--;if(w.length===0){delete this._callbacks[x];delete l[x][this[0]]}}}else{w[v].call(this,y)}}w.depth--},_unbindCallbacks:function(x,v){if(!this._callbacks[x]){return}var w=this._callbacks[x];for(var u=0;u<w.length;u++){if(!v||w[u]==v){delete w[u]}}},_unbindAll:function(){if(!this._callbacks){return}for(var u in this._callbacks){if(this._callbacks[u]){this._unbindCallbacks(u);delete l[u][this[0]]}}}};n._addCallbackMethods=function(u){u.extend(n._callbackMethods);u._callbacks={}};n._addCallbackMethods(n);n.extend({0:"global",init:function(u,y,z){if(!this._preBindDone){for(var x=0;x<this._bindOnInit.length;x++){var v=this._bindOnInit[x];n.bind(v.event,v.handler)}}n.viewport.init(u,y,z);this.trigger("Load");this.timer.init();return this},_bindOnInit:[],_preBindDone:false,_preBind:function(v,u){this._bindOnInit.push({event:v,handler:u})},getVersion:function(){return g},stop:function(u){n.trigger("CraftyStop",u);this.timer.stop();if(u){n.audio.remove();if(n.stage&&n.stage.elem.parentNode){var v=document.createElement("div");v.id=n.stage.elem.id;n.stage.elem.parentNode.replaceChild(v,n.stage.elem)}delete n.canvasLayer.context;delete n.domLayer._div;delete n.webgl.context;n._unbindAll();n._addCallbackMethods(n);this._preBindDone=false;r()}return this},pause:function(u){if(arguments.length===1?u:!this._paused){this.trigger("Pause");this._paused=true;setTimeout(function(){n.timer.stop()},0);n.keydown={}}else{this.trigger("Unpause");this._paused=false;setTimeout(function(){n.timer.init()},0)}return this},isPaused:function(){return this._paused},timer:(function(){var v,y;var x="fixed",D=5,C=40;var z=0,u=0,w;var B=50,A=1000/B;return{init:function(){if(typeof w==="undefined"){w=(new Date().getTime())-A}var E=(typeof window!=="undefined")&&(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||null);if(E){v=function(){n.timer.step();if(v!==null){y=E(v)}};v()}else{v=setInterval(function(){n.timer.step()},1000/B)}},stop:function(){n.trigger("CraftyStopTimer");if(typeof v!=="function"){clearInterval(v)}var E=(typeof window!=="undefined")&&(window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||null);if(E){E(y)}v=null},steptype:function(F,E){if(F==="variable"||F==="semifixed"){x=F;if(E){C=E}}else{if(F==="fixed"){x="fixed";if(E){D=E}}else{throw"Invalid step type specified"}}},step:function(){var K,J,F,E=0;currentTime=new Date().getTime();if(z>0){n.trigger("MeasureWaitTime",currentTime-z)}if(w+u>=currentTime){z=currentTime;return}var H=currentTime-(w+u);if(H>A*20){u+=H-A;H=A}if(x==="fixed"){E=Math.ceil(H/A);E=Math.min(E,D);J=A}else{if(x==="variable"){E=1;J=H;J=Math.min(J,C)}else{if(x==="semifixed"){E=Math.ceil(H/C);J=H/E}}}for(var G=0;G<E;G++){F=currentTime;var I={frame:k++,dt:J,gameTime:w};n.trigger("EnterFrame",I);n.trigger("ExitFrame",I);w+=J;currentTime=new Date().getTime();n.trigger("MeasureFrameTime",currentTime-F)}if(E>0){K=currentTime;n.trigger("PreRender");n.trigger("RenderScene");n.trigger("PostRender");currentTime=new Date().getTime();n.trigger("MeasureRenderTime",currentTime-K)}z=currentTime},FPS:function(E){if(typeof E=="undefined"){return B}else{B=E;A=1000/B;n.trigger("FPSChange",E)}},simulateFrames:function(G,E){if(typeof E==="undefined"){E=A}while(G-->0){var F={frame:k++,dt:E};n.trigger("EnterFrame",F);n.trigger("ExitFrame",F)}n.trigger("PreRender");n.trigger("RenderScene");n.trigger("PostRender")}}})(),e:function(){var u=i();b[u]=null;b[u]=n(u);if(arguments.length>0){b[u].addComponent.apply(b[u],arguments)}b[u].setName("Entity #"+u);b[u].addComponent("obj");n.trigger("NewEntity",{id:u});return b[u]},c:function(v,u){j[v]=u},trigger:function(x,y){var v=l[x]||(l[x]={}),u,w;for(u in v){if(!v.hasOwnProperty(u)){continue}w=v[u];if(!w||w.length===0){continue}w.context._runCallbacks(x,y)}},bind:function(u,v){this._bindCallback(u,v);return v},uniqueBind:function(u,v){this.unbind(u,v);return this.bind(u,v)},one:function(w,x){var v=this;var u=function(y){x.call(v,y);v.unbind(w,u)};return v.bind(w,u)},unbind:function(u,v){this._unbindCallbacks(u,v)},frame:function(){return k},components:function(){return j},isComp:function(u){return u in j},debug:function(u){if(u==="handlers"){return l}return b},settings:(function(){var u={},v={};return{register:function(w,x){v[w]=x},modify:function(w,x){if(!v[w]){return}v[w].call(u[w],x);u[w]=x},get:function(w){return u[w]}}})(),defineField:function(w,x,v,u){Object.defineProperty(w,x,{get:v,set:u,configurable:false,enumerable:true,})},clone:q});function i(){var u=t++;if(u in b){return i()}return u}function q(w){if(w===null||typeof(w)!="object"){return w}var u=w.constructor();for(var v in w){u[v]=q(w[v])}return u}if(typeof define==="function"){define("crafty",[],function(){return n})}a.exports=n},{"./version":16}],8:[function(b,d,a){(function(i){var h=b("./core");var f=(typeof window!=="undefined")&&window.document;(function g(){var m=h.support={},l=(typeof navigator!=="undefined"&&navigator.userAgent.toLowerCase())||(typeof i!=="undefined"&&i.version),k=/(webkit)[ \/]([\w.]+)/.exec(l)||/(o)pera(?:.*version)?[ \/]([\w.]+)/.exec(l)||/(ms)ie ([\w.]+)/.exec(l)||/(moz)illa(?:.*? rv:([\w.]+))?/.exec(l)||/(v)\d+\.(\d+)/.exec(l)||[],j=/iPad|iPod|iPhone|Android|webOS|IEMobile/i.exec(l);if(j){h.mobile=j[0]}m.defineProperty=(function(){if(!("defineProperty" in Object)){return false}try{Object.defineProperty({},"x",{})}catch(q){return false}return true})();m.audio=(typeof window!=="undefined")&&("canPlayType" in f.createElement("audio"));m.prefix=(k[1]||k[0]);if(m.prefix==="moz"){m.prefix="Moz"}if(m.prefix==="o"){m.prefix="O"}if(m.prefix==="v"){m.prefix="node"}if(k[2]){m.versionName=k[2];m.version=+(k[2].split("."))[0]}m.canvas=(typeof window!=="undefined")&&("getContext" in f.createElement("canvas"));if(m.canvas){var o;try{var p=f.createElement("canvas");o=p.getContext("webgl")||p.getContext("experimental-webgl");o.viewportWidth=m.canvas.width;o.viewportHeight=m.canvas.height}catch(n){}m.webgl=!!o}else{m.webgl=false}m.css3dtransform=(typeof window!=="undefined")&&((typeof f.createElement("div").style.Perspective!=="undefined")||(typeof f.createElement("div").style[m.prefix+"Perspective"]!=="undefined"));m.deviceorientation=(typeof window!=="undefined")&&((typeof window.DeviceOrientationEvent!=="undefined")||(typeof window.OrientationEvent!=="undefined"));m.devicemotion=(typeof window!=="undefined")&&(typeof window.DeviceMotionEvent!=="undefined")})();d.exports={_events:{},addEvent:function(j,m,l,o){if(arguments.length===3){o=l;l=m;m=window.document}var k=function(p){o.call(j,p)},n=j[0]||"";if(!this._events[n+m+l+o]){this._events[n+m+l+o]=k}else{return}m.addEventListener(l,k,false)},removeEvent:function(j,m,l,o){if(arguments.length===3){o=l;l=m;m=window.document}var n=j[0]||"",k=this._events[n+m+l+o];if(k){m.removeEventListener(l,k,false);delete this._events[n+m+l+o]}},background:function(j){h.stage.elem.style.background=j}}}).call(this,b("_process"))},{"./core":7,_process:1}],9:[function(b,d,a){var f=b("../core/core.js");d.exports={assets:{},__paths:{audio:"",images:""},paths:function(g){if(typeof g==="undefined"){return this.__paths}else{if(g.audio){this.__paths.audio=g.audio}if(g.images){this.__paths.images=g.images}}},asset:function(g,h){if(arguments.length===1){return f.assets[g]}if(!f.assets[g]){f.assets[g]=h;this.trigger("NewAsset",{key:g,value:h});return h}},image_whitelist:["jpg","jpeg","gif","png","svg"],load:function(D,p,k,h){if(Array.isArray(D)){f.log("Calling Crafty.load with an array of assets no longer works; see the docs for more details.")}D=(typeof D==="string"?JSON.parse(D):D);var A=0,E=(D.audio?Object.keys(D.audio).length:0)+(D.images?Object.keys(D.images).length:0)+(D.sprites?Object.keys(D.sprites).length:0),x,r,s,m,t,C=f.support.audio,y=f.paths(),z=function(i){return i.substr(i.lastIndexOf(".")+1).toLowerCase()},u=function(i,j){return(j.search("://")===-1?(i=="audio"?y.audio+j:y.images+j):j)},w=function(i){return f.asset(i)||null},g=function(i){return f.audio.supports(z(i))},l=function(i){return f.image_whitelist.indexOf(z(i))!=-1},v=function(j,i){j.onload=q;if(f.support.prefix==="webkit"){j.src=""}j.src=i};function q(){var i=this.src;if(this.removeEventListener){this.removeEventListener("canplaythrough",q,false)}A++;if(k){k({loaded:A,total:E,percent:(A/E*100),src:i})}if(A===E&&p){p()}}function o(){var i=this.src;if(h){h({loaded:A,total:E,percent:(A/E*100),src:i})}A++;if(A===E&&p){p()}}for(m in D){for(t in D[m]){if(!D[m].hasOwnProperty(t)){continue}x=D[m][t];if(m==="audio"&&C){if(typeof x==="object"){var n=[];for(var B in x){r=u(m,x[B]);if(!w(r)&&g(x[B])){n.push(r)}}s=f.audio.add(t,n).obj}else{if(typeof x==="string"&&g(x)){r=u(m,x);if(!w(r)){s=f.audio.add(t,r).obj}}}if(s&&s.addEventListener){s.addEventListener("canplaythrough",q,false)}}else{t=(m==="sprites"?t:x);r=u(m,t);if(l(t)){s=w(r);if(!s){s=new Image();if(m==="sprites"){f.sprite(x.tile,x.tileh,r,x.map,x.paddingX,x.paddingY,x.paddingAroundBorder)}f.asset(r,s)}v(s,r)}}if(s){s.onerror=o}else{--E}}}if(E===0){p()}},removeAssets:function(h){h=(typeof h==="string"?JSON.parse(h):h);var l,o,m,g,p=f.paths(),n=function(i,q){return(q.search("://")===-1?(i=="audio"?p.audio+q:p.images+q):q)};for(m in h){for(g in h[m]){if(!h[m].hasOwnProperty(g)){continue}l=h[m][g];if(m==="audio"){if(typeof l==="object"){for(var j in l){o=n(m,l[j]);if(f.asset(o)){f.audio.remove(g)}}}else{if(typeof l==="string"){o=n(m,l);if(f.asset(o)){f.audio.remove(g)}}}}else{g=(m==="sprites"?g:l);o=n(m,g);if(f.asset(o)){if(m==="sprites"){for(var k in l.map){delete f.components()[k]}}delete f.assets[o]}}}}}}},{"../core/core.js":7}],10:[function(b,d,a){d.exports={init:function(){this.changed=[];this.bind("Change",this._changed_attributes);this.bind("Change",this._changed_triggers)},_changed_triggers:function(i,g){var h,f;g=Crafty.extend.call({pre:""},g);for(h in i){this.trigger("Change["+g.pre+h+"]",i[h]);if(i[h].constructor===Object){this._changed_triggers(i[h],{pre:g.pre+h+"."})}}},_changed_attributes:function(g){var f;for(f in g){this.changed.push(f)}return this},is_dirty:function(f){if(arguments.length===0){return !!this.changed.length}else{return this.changed.indexOf(f)>-1}}}},{}],11:[function(b,d,a){var f=b("../core/core.js");d.exports={_scenes:{},_current:null,scene:function(h,i,g){if(arguments.length===1||typeof(arguments[1])!=="function"){f.enterScene(h,arguments[1]);return}f.defineScene(h,i,g)},defineScene:function(g,i,h){if(typeof i!=="function"){throw ("Init function is the wrong type.")}this._scenes[g]={};this._scenes[g].initialize=i;if(typeof h!=="undefined"){this._scenes[g].uninitialize=h}return},enterScene:function(g,i){if(typeof i==="function"){throw ("Scene data cannot be a function")}f.trigger("SceneDestroy",{newScene:g});f.viewport.reset();f("2D").each(function(){if(!this.has("Persist")){this.destroy()}});if(this._current!==null&&"uninitialize" in this._scenes[this._current]){this._scenes[this._current].uninitialize.call(this)}var h=this._current;this._current=g;f.trigger("SceneChange",{oldScene:h,newScene:g});if(this._scenes.hasOwnProperty(g)){this._scenes[g].initialize.call(this,i)}else{f.error('The scene "'+g+'" does not exist')}return}}},{"../core/core.js":7}],12:[function(d,f,b){var g=d("../core/core.js");try{var i=(typeof window!=="undefined"&&window.localStorage)||(new d("node-localstorage").LocalStorage("./localStorage"))}catch(h){var i=null}var a=function(k,l){var j=l;if(!i){g.error("Local storage is not accessible.  (Perhaps you are including crafty.js cross-domain?)");return false}if(arguments.length===1){try{return JSON.parse(i.getItem(k))}catch(m){return i.getItem(k)}}else{if(typeof l==="object"){j=JSON.stringify(l)}i.setItem(k,j)}};a.remove=function(j){if(!i){g.error("Local storage is not accessible.  (Perhaps you are including crafty.js cross-domain?)");return}i.removeItem(j)};f.exports=a},{"../core/core.js":7}],13:[function(b,d,a){var f=b("../core/core.js");f._systems={};f.s=function(g,i,h){if(i){if(h===false){f._systems[g]=new f.CraftySystem(g,i);f.trigger("SystemLoaded",g)}else{f._registerLazySystem(g,i)}}else{return f._systems[g]}};f._registerLazySystem=function(g,h){Object.defineProperty(f._systems,g,{get:function(){Object.defineProperty(f._systems,g,{value:new f.CraftySystem(g,h),writable:true,enumerable:true,configurable:true});f.trigger("SystemLoaded",g);return f._systems[g]},configurable:true})};f.CraftySystem=(function(){systemID=1;return function(h,j){this.name=h;if(!j){return this}this._systemTemplate=j;this.extend(j);f._addCallbackMethods(this);this[0]="system"+(systemID++);if(typeof this.init==="function"){this.init(h)}if("events" in j){var k=j.events;for(var g in k){var i=typeof k[g]==="function"?k[g]:j[k[g]];this.bind(g,i)}}}})();f.CraftySystem.prototype={extend:function(h){for(var g in h){if(typeof this[g]==="undefined"){this[g]=h[g]}}},bind:function(g,h){this._bindCallback(g,h);return this},trigger:function(g,h){this._runCallbacks(g,h);return this},unbind:function(g,h){this._unbindCallbacks(g,h);return this},one:function(i,j){var h=this;var g=function(k){j.call(h,k);h.unbind(i,g)};return h.bind(i,g)},uniqueBind:function(g,h){this.unbind(g,h);return this.bind(g,h)},destroy:function(){f.trigger("SystemDestroyed",this);if(typeof this.remove==="function"){this.remove()}this._unbindAll();delete f._systems[this.name]}}},{"../core/core.js":7}],14:[function(b,d,a){d.exports={init:function(){this._delays=[];this.bind("EnterFrame",function(g){var f=this._delays.length;while(--f>=0){var h=this._delays[f];if(h===false){this._delays.splice(f,1)}else{h.accumulator+=g.dt;while(h.accumulator>=h.delay&&h.repeat>=0){h.accumulator-=h.delay;h.repeat--;h.callback.call(this)}if(h.repeat<0){this._delays.splice(f,1);if(typeof h.callbackOff==="function"){h.callbackOff.call(this)}}}}})},delay:function(i,f,h,g){this._delays.push({accumulator:0,callback:i,callbackOff:g,delay:f,repeat:(h<0?Infinity:h)||0,});return this},cancelDelay:function(h){var f=this._delays.length;while(--f>=0){var g=this._delays[f];if(g&&g.callback==h){this._delays[f]=false}}return this}}},{}],15:[function(b,d,a){d.exports={init:function(){this.tweenGroup={};this.tweenStart={};this.tweens=[];this.uniqueBind("EnterFrame",this._tweenTick)},_tweenTick:function(j){var h,f,g;for(g=this.tweens.length-1;g>=0;g--){h=this.tweens[g];h.easing.tick(j.dt);f=h.easing.value();this._doTween(h.props,f);if(h.easing.complete){this.tweens.splice(g,1);this._endTween(h.props)}}},_doTween:function(h,f){for(var g in h){this[g]=(1-f)*this.tweenStart[g]+f*h[g]}},tween:function(g,i,h){var f={props:g,easing:new Crafty.easing(i,h)};for(var j in g){if(typeof this.tweenGroup[j]!=="undefined"){this.cancelTween(j)}this.tweenStart[j]=this[j];this.tweenGroup[j]=g}this.tweens.push(f);return this},cancelTween:function(f){if(typeof f==="string"){if(typeof this.tweenGroup[f]=="object"){delete this.tweenGroup[f][f]}}else{if(typeof f==="object"){for(var g in f){this.cancelTween(g)}}}return this},pauseTweens:function(){this.tweens.map(function(f){f.easing.pause()})},resumeTweens:function(){this.tweens.map(function(f){f.easing.resume()})},_endTween:function(f){for(var g in f){delete this.tweenGroup[g]}this.trigger("TweenEnd",f)}}},{}],16:[function(b,d,a){d.exports="0.7.1"},{}],17:[function(b,d,a){var f=b("./core/core");f.easing=b("./core/animation");f.extend(b("./core/extensions"));f.extend(b("./core/loader"));f.c("Model",b("./core/model"));f.extend(b("./core/scenes"));f.storage=b("./core/storage");f.c("Delay",b("./core/time"));f.c("Tween",b("./core/tween"));b("./core/systems");b("./spatial/2d");b("./spatial/collision");b("./spatial/spatial-grid");b("./spatial/rect-manager");b("./spatial/math");b("./graphics/canvas");b("./graphics/canvas-layer");b("./graphics/color");b("./graphics/dom");b("./graphics/dom-helper");b("./graphics/dom-layer");b("./graphics/drawing");b("./graphics/gl-textures");b("./graphics/html");b("./graphics/image");b("./graphics/particles");b("./graphics/sprite-animation");b("./graphics/sprite");b("./graphics/text");b("./graphics/viewport");b("./graphics/webgl");b("./isometric/diamond-iso");b("./isometric/isometric");b("./controls/inputs");b("./controls/controls");b("./controls/device");b("./controls/keycodes");b("./sound/sound");b("./debug/debug-layer");b("./debug/logging");if(window){window.Crafty=f}d.exports=f},{"./controls/controls":2,"./controls/device":3,"./controls/inputs":4,"./controls/keycodes":5,"./core/animation":6,"./core/core":7,"./core/extensions":8,"./core/loader":9,"./core/model":10,"./core/scenes":11,"./core/storage":12,"./core/systems":13,"./core/time":14,"./core/tween":15,"./debug/debug-layer":18,"./debug/logging":19,"./graphics/canvas":21,"./graphics/canvas-layer":20,"./graphics/color":22,"./graphics/dom":25,"./graphics/dom-helper":23,"./graphics/dom-layer":24,"./graphics/drawing":26,"./graphics/gl-textures":27,"./graphics/html":28,"./graphics/image":29,"./graphics/particles":30,"./graphics/sprite":32,"./graphics/sprite-animation":31,"./graphics/text":33,"./graphics/viewport":34,"./graphics/webgl":35,"./isometric/diamond-iso":36,"./isometric/isometric":37,"./sound/sound":38,"./spatial/2d":39,"./spatial/collision":40,"./spatial/math":41,"./spatial/rect-manager":42,"./spatial/spatial-grid":43}],18:[function(d,f,b){var g=d("../core/core.js"),a=window.document;g.c("DebugCanvas",{init:function(){this.requires("2D");if(!g.DebugCanvas.context){g.DebugCanvas.init()}g.DebugCanvas.add(this);this._debug={alpha:1,lineWidth:1};this.bind("RemoveComponent",this.onDebugRemove);this.bind("Remove",this.onDebugDestroy)},onDebugRemove:function(h){if(h==="DebugCanvas"){g.DebugCanvas.remove(this)}},onDebugDestroy:function(h){g.DebugCanvas.remove(this)},debugAlpha:function(h){this._debug.alpha=h;return this},debugFill:function(h){if(typeof h==="undefined"){h="red"}this._debug.fillStyle=h;return this},debugStroke:function(h){if(typeof h==="undefined"){h="red"}this._debug.strokeStyle=h;return this},debugDraw:function(h){var j=h.globalAlpha;var i=this._debug;if(i.alpha){h.globalAlpha=this._debug.alpha}if(i.strokeStyle){h.strokeStyle=i.strokeStyle}if(i.lineWidth){h.lineWidth=i.lineWidth}if(i.fillStyle){h.fillStyle=i.fillStyle}this.trigger("DebugDraw");h.globalAlpha=j}});g.c("DebugRectangle",{init:function(){this.requires("2D, DebugCanvas")},debugRectangle:function(h){this.debugRect=h;this.unbind("DebugDraw",this.drawDebugRect);this.bind("DebugDraw",this.drawDebugRect);return this},drawDebugRect:function(){var h=g.DebugCanvas.context;var i=this.debugRect;if(i===null||i===undefined){return}if(i._h&&i._w){if(this._debug.fillStyle){h.fillRect(i._x,i._y,i._w,i._h)}if(this._debug.strokeStyle){h.strokeRect(i._x,i._y,i._w,i._h)}}}});g.c("VisibleMBR",{init:function(){this.requires("DebugRectangle").debugFill("purple").bind("EnterFrame",this._assignRect)},_assignRect:function(){if(this._mbr){this.debugRectangle(this._mbr)}else{this.debugRectangle(this)}}});g.c("DebugPolygon",{init:function(){this.requires("2D, DebugCanvas")},debugPolygon:function(h){this.polygon=h;this.unbind("DebugDraw",this.drawDebugPolygon);this.bind("DebugDraw",this.drawDebugPolygon);return this},drawDebugPolygon:function(){if(typeof this.polygon==="undefined"){return}var j=g.DebugCanvas.context;j.beginPath();var m=this.polygon.points,h=m.length;for(var k=0;k<h;k+=2){j.lineTo(m[k],m[k+1])}j.closePath();if(this._debug.fillStyle){j.fill()}if(this._debug.strokeStyle){j.stroke()}}});g.c("WiredHitBox",{init:function(){this.requires("DebugPolygon").debugStroke("red").matchHitBox();this.bind("NewHitbox",this.matchHitBox)},matchHitBox:function(){this.debugPolygon(this.map)}});g.c("SolidHitBox",{init:function(){this.requires("Collision, DebugPolygon").debugFill("orange").debugAlpha(0.7).matchHitBox();this.bind("NewHitbox",this.matchHitBox)},matchHitBox:function(){this.debugPolygon(this.map)}});g.c("WiredAreaMap",{init:function(){this.requires("DebugPolygon").debugStroke("green").matchAreaMap();this.bind("NewAreaMap",this.matchAreaMap)},matchAreaMap:function(){this.debugPolygon(this.mapArea)}});g.c("SolidAreaMap",{init:function(){this.requires("DebugPolygon").debugFill("lime").debugAlpha(0.7).matchAreaMap();this.bind("NewAreaMap",this.matchAreaMap)},matchAreaMap:function(){this.debugPolygon(this.mapArea)}});g.DebugCanvas={context:null,entities:[],onetimeEntities:[],add:function(h){this.entities.push(h)},remove:function(k){var j=this.entities;for(var h=j.length-1;h>=0;h--){if(j[h]==k){j.splice(h,1)}}},init:function(){if(!g.DebugCanvas.context){if(!g.support.canvas){g.trigger("NoCanvas");g.stop();return}var h;h=a.createElement("canvas");h.width=g.viewport.width;h.height=g.viewport.height;h.style.position="absolute";h.style.left="0px";h.style.top="0px";h.id="debug-canvas";h.style.zIndex=100000;g.stage.elem.appendChild(h);g.DebugCanvas.context=h.getContext("2d");g.DebugCanvas._canvas=h}g.unbind("RenderScene",g.DebugCanvas.renderScene);g.bind("RenderScene",g.DebugCanvas.renderScene)},renderScene:function(n){n=n||g.viewport.rect();var o=g.DebugCanvas.entities,m=0,k=o.length,j=g.DebugCanvas.context,p;var h=g.viewport;j.setTransform(h._scale,0,0,h._scale,Math.round(h._x*h._scale),Math.round(h._y*h._scale));j.clearRect(n._x,n._y,n._w,n._h);for(;m<k;m++){p=o[m];p.debugDraw(j)}}}},{"../core/core.js":7}],19:[function(b,d,a){var f=b("../core/core.js");f.extend({loggingEnabled:true,log:function(){if(f.loggingEnabled&&console&&console.log){console.log.apply(console,arguments)}},error:function(){if(f.loggingEnabled&&console&&console.error){console.error.apply(console,arguments)}}})},{"../core/core.js":7}],20:[function(b,d,a){var f=b("../core/core.js");f.extend({canvasLayer:{_dirtyRects:[],_changedObjs:[],layerCount:0,_dirtyViewport:false,_sort:function(i,h){return i._globalZ-h._globalZ},add:function g(h){this._changedObjs.push(h)},context:null,_canvas:null,init:function(){if(!f.support.canvas){f.trigger("NoCanvas");f.stop();return}this._dirtyRects=[];this._changedObjs=[];this.layerCount=0;var j;j=document.createElement("canvas");j.width=f.viewport.width;j.height=f.viewport.height;j.style.position="absolute";j.style.left="0px";j.style.top="0px";var h=f.canvasLayer;f.stage.elem.appendChild(j);this.context=j.getContext("2d");this._canvas=j;var i=f.viewport._scale;if(i!=1){j.scale(i,i)}this._setPixelart(f._pixelartEnabled);f.uniqueBind("PixelartSet",this._setPixelart);f.uniqueBind("RenderScene",this._render);f.uniqueBind("ViewportResize",this._resize);f.bind("InvalidateViewport",function(){f.canvasLayer._dirtyViewport=true})},_render:function(){var m=f.canvasLayer,k=m._dirtyViewport,j=m._changedObjs.length,i=m.context;if(!j&&!k){return}if(k){var h=f.viewport;i.setTransform(h._scale,0,0,h._scale,Math.round(h._x*h._scale),Math.round(h._y*h._scale))}if(j/m.layerCount>0.6||k){m._drawAll()}else{m._drawDirty()}m._clean()},_drawDirty:function(){var s,o,k,x,u,r,w,p=this._changedObjs,n=p.length,h=this._dirtyRects,v=f.rectManager,y=v.overlap,z=this.context,A=[],t=[];for(s=0;s<n;s++){this._createDirty(p[s])}v.mergeSet(h);n=h.length;for(s=0;s<n;++s){x=h[s];A.length=0;t.length=0;if(!x){continue}x._w=x._x+x._w;x._h=x._y+x._h;x._x=(x._x>0)?(x._x|0):(x._x|0)-1;x._y=(x._y>0)?(x._y|0):(x._y|0)-1;x._w-=x._x;x._h-=x._y;x._w=(x._w===(x._w|0))?x._w:(x._w|0)+1;x._h=(x._h===(x._h|0))?x._h:(x._h|0)+1;k=f.map.search(x,false);z.clearRect(x._x,x._y,x._w,x._h);z.save();z.beginPath();z.rect(x._x,x._y,x._w,x._h);z.clip();for(o=0,u=k.length;o<u;++o){r=k[o];if(A[r[0]]||!r._visible||!r.__c.Canvas){continue}A[r[0]]=true;t.push(r)}t.sort(this._sort);for(o=0,u=t.length;o<u;++o){r=t[o];var m=r._mbr||r;if(y(m,x)){r.draw()}r._changed=false}z.closePath();z.restore()}if(f.canvasLayer.debugDirty===true){z.strokeStyle="red";for(s=0,n=h.length;s<n;++s){x=h[s];z.strokeRect(x._x,x._y,x._w,x._h)}}},_drawAll:function(m){m=m||f.viewport.rect();var n=f.map.search(m),k=0,j=n.length,h=this.context,o;h.clearRect(m._x,m._y,m._w,m._h);n.sort(this._sort);for(;k<j;k++){o=n[k];if(o._visible&&o.__c.Canvas){o.draw();o._changed=false}}},debug:function(){f.log(this._changedObjs)},_clean:function(){var k,m,j,h,n=this._changedObjs;for(j=0,h=n.length;j<h;j++){m=n[j];k=m._mbr||m;if(typeof m.staleRect==="undefined"){m.staleRect={}}m.staleRect._x=k._x;m.staleRect._y=k._y;m.staleRect._w=k._w;m.staleRect._h=k._h;m._changed=false}n.length=0;this._dirtyRects.length=0;this._dirtyViewport=false},_createDirty:function(k){var j=k._mbr||k,i=this._dirtyRects,h=f.rectManager;if(k.staleRect){if(h.overlap(k.staleRect,j)){h.merge(k.staleRect,j,k.staleRect);i.push(k.staleRect);return}else{i.push(k.staleRect)}}k.currentRect._x=j._x;k.currentRect._y=j._y;k.currentRect._w=j._w;k.currentRect._h=j._h;i.push(k.currentRect)},_resize:function(){var h=f.canvasLayer._canvas;h.width=f.viewport.width;h.height=f.viewport.height},_setPixelart:function(h){var i=f.canvasLayer.context;i.imageSmoothingEnabled=!h;i.mozImageSmoothingEnabled=!h;i.webkitImageSmoothingEnabled=!h;i.oImageSmoothingEnabled=!h;i.msImageSmoothingEnabled=!h}}})},{"../core/core.js":7}],21:[function(b,d,a){var f=b("../core/core.js");f.c("Canvas",{init:function(){var g=f.canvasLayer;if(!g.context){g.init()}this._drawLayer=g;this._drawContext=g.context;g.layerCount++;this.currentRect={};this._changed=true;g.add(this);this.bind("Invalidate",function(h){if(this._changed===false){this._changed=true;g.add(this)}});this.bind("Remove",function(){this._drawLayer.layerCount--;this._changed=true;this._drawLayer.add(this)})},drawVars:{type:"canvas",pos:{},ctx:null,coord:[0,0,0,0],co:{x:0,y:0,w:0,h:0}},draw:function(j,g,o,i,l){if(!this.ready){return}if(arguments.length===4){l=i;i=o;o=g;g=j;j=this._drawContext}var n=this.drawVars.pos;n._x=(this._x+(g||0));n._y=(this._y+(o||0));n._w=(i||this._w);n._h=(l||this._h);context=j||this._drawContext;coord=this.__coord||[0,0,0,0];var m=this.drawVars.co;m.x=coord[0]+(g||0);m.y=coord[1]+(o||0);m.w=i||coord[2];m.h=l||coord[3];if(this._flipX||(this._flipY||this._rotation)){context.save()}if(this._rotation!==0){context.translate(this._origin.x+this._x,this._origin.y+this._y);n._x=-this._origin.x;n._y=-this._origin.y;context.rotate((this._rotation%360)*(Math.PI/180))}if(this._flipX||this._flipY){context.scale((this._flipX?-1:1),(this._flipY?-1:1));if(this._flipX){n._x=-(n._x+n._w)}if(this._flipY){n._y=-(n._y+n._h)}}var k;if(this._alpha<1){k=context.globalAlpha;context.globalAlpha=this._alpha}this.drawVars.ctx=context;this.trigger("Draw",this.drawVars);if(this._rotation!==0||(this._flipX||this._flipY)){context.restore()}if(k){context.globalAlpha=k}return this}})},{"../core/core.js":7}],22:[function(g,h,d){var j=g("../core/core.js"),a=window.document;j.extend({assignColor:(function(){var m=a.createElement("div");m.style.display="none";var r=false;var q={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#00ff00",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"};function u(v){v._red=v._blue=v._green=0;return v}function s(v){var w=v.toString(16);if(w.length==1){w="0"+w}return w}function n(x,w,v){return"#"+s(x)+s(w)+s(v)}function p(w,x){var v;if(w.length===7){v=2}else{if(w.length===4){v=1}else{return u(x)}}x._red=parseInt(w.substr(1,v),16);x._green=parseInt(w.substr(1+v,v),16);x._blue=parseInt(w.substr(1+2*v,v),16);return x}var t=/rgba?\s*\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,?\s*([0-9.]+)?\)/;function o(w,x){var v=t.exec(w);if(v===null||(v.length!=4&&v.length!=5)){return u(x)}x._red=Math.round(parseFloat(v[1]));x._green=Math.round(parseFloat(v[2]));x._blue=Math.round(parseFloat(v[3]));if(v[4]){x._strength=parseFloat(v[4])}return x}function l(w,x){if(typeof q[w]==="undefined"){if(r===false){window.document.body.appendChild(m);r=true}m.style.color=w;var v=window.getComputedStyle(m).color;o(v,x);q[w]=n(x._red,x._green,x._blue)}else{p(q[w],x)}return x}function k(v){return"rgba("+v._red+", "+v._green+", "+v._blue+", "+v._strength+")"}return function(v,x){x=x||{};v=v.trim().toLowerCase();var w=null;if(v[0]==="#"){w=p(v,x)}else{if(v[0]==="r"&&v[1]==="g"&&v[2]==="b"){w=o(v,x)}else{w=l(v,x)}}x._strength=x._strength||1;x._color=k(x)}})()});var i="attribute vec2 aPosition;\nattribute vec3 aOrientation;\nattribute vec2 aLayer;\nattribute vec4 aColor;\n\nvarying lowp vec4 vColor;\n\nuniform  vec4 uViewport;\n\nmat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\n\nvoid main() {\n  vec2 pos = aPosition;\n  vec2 entityOrigin = aOrientation.xy;\n  mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));\n\n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin;\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );\n  vColor = vec4(aColor.rgb*aColor.a*aLayer.y, aColor.a*aLayer.y);\n}";var f="precision mediump float;\nvarying lowp vec4 vColor;\nvoid main(void) {\n\tgl_FragColor = vColor;\n}";var b=[{name:"aPosition",width:2},{name:"aOrientation",width:3},{name:"aLayer",width:2},{name:"aColor",width:4}];j.c("Color",{_red:0,_green:0,_blue:0,_strength:1,_color:"",ready:true,init:function(){this.bind("Draw",this._drawColor);if(this.has("WebGL")){this._establishShader("Color",f,i,b)}this.trigger("Invalidate")},remove:function(){this.unbind("Draw",this._drawColor);if(this.has("DOM")){this._element.style.backgroundColor="transparent"}this.trigger("Invalidate")},_drawColor:function(k){if(!this._color){return}if(k.type==="DOM"){k.style.backgroundColor=this._color;k.style.lineHeight=0}else{if(k.type==="canvas"){k.ctx.fillStyle=this._color;k.ctx.fillRect(k.pos._x,k.pos._y,k.pos._w,k.pos._h)}else{if(k.type==="webgl"){k.program.writeVector("aColor",this._red/255,this._green/255,this._blue/255,this._strength)}}}},color:function(k){if(arguments.length===0){return this._color}else{if(arguments.length>=3){this._red=arguments[0];this._green=arguments[1];this._blue=arguments[2];if(typeof arguments[3]==="number"){this._strength=arguments[3]}}else{j.assignColor(k,this);if(typeof arguments[1]=="number"){this._strength=arguments[1]}}}this._color="rgba("+this._red+", "+this._green+", "+this._blue+", "+this._strength+")";this.trigger("Invalidate");return this}})},{"../core/core.js":7}],23:[function(d,f,b){var g=d("../core/core.js"),a=window.document;g.extend({domHelper:{innerPosition:function(l){var k=l.getBoundingClientRect(),h=k.left+(window.pageXOffset?window.pageXOffset:a.body.scrollLeft),m=k.top+(window.pageYOffset?window.pageYOffset:a.body.scrollTop),j=parseInt(this.getStyle(l,"border-left-width")||0,10)||parseInt(this.getStyle(l,"borderLeftWidth")||0,10)||0,i=parseInt(this.getStyle(l,"border-top-width")||0,10)||parseInt(this.getStyle(l,"borderTopWidth")||0,10)||0;h+=j;m+=i;return{x:h,y:m}},getStyle:function(i,j){var h;if(i.currentStyle){h=i.currentStyle[this.camelize(j)]}else{if(window.getComputedStyle){h=a.defaultView.getComputedStyle(i,null).getPropertyValue(this.csselize(j))}}return h},camelize:function(h){return h.replace(/-+(.)?/g,function(i,j){return j?j.toUpperCase():""})},csselize:function(h){return h.replace(/[A-Z]/g,function(i){return i?"-"+i.toLowerCase():""})},translate:function(j,i){var k=a.documentElement;var h=a.body;return{x:(j-g.stage.x+(k&&k.scrollLeft||h&&h.scrollLeft||0))/g.viewport._scale-g.viewport._x,y:(i-g.stage.y+(k&&k.scrollTop||h&&h.scrollTop||0))/g.viewport._scale-g.viewport._y}}}})},{"../core/core.js":7}],24:[function(d,f,b){var g=d("../core/core.js"),a=window.document;g.extend({domLayer:{_changedObjs:[],_dirtyViewport:false,_div:null,init:function(){this._changedObjs=[];this._dirtyViewport=false;var i=this._div=a.createElement("div");g.stage.elem.appendChild(i);i.style.position="absolute";i.style.zIndex="1";i.style.transformStyle="preserve-3d";g.uniqueBind("RenderScene",this._render);g.uniqueBind("PixelartSet",this._setPixelArt);g.uniqueBind("InvalidateViewport",function(){g.domLayer._dirtyViewport=true})},_setPixelArt:function(j){var k=g.domLayer._div.style;var i=g.domHelper.camelize;if(j){k[i("image-rendering")]="optimizeSpeed";k[i("image-rendering")]="-moz-crisp-edges";k[i("image-rendering")]="-o-crisp-edges";k[i("image-rendering")]="-webkit-optimize-contrast";k[i("-ms-interpolation-mode")]="nearest-neighbor";k[i("image-rendering")]="optimize-contrast";k[i("image-rendering")]="pixelated";k[i("image-rendering")]="crisp-edges"}else{k[i("image-rendering")]="optimizeQuality";k[i("-ms-interpolation-mode")]="bicubic";k[i("image-rendering")]="auto"}},debug:function(){g.log(this._changedObjs)},_render:function(){var m=g.domLayer;var n=m._changedObjs;if(m._dirtyViewport){m._setViewport();m._dirtyViewport=false}if(!n.length){return}var l=0,j=n.length;for(;l<j;++l){n[l].draw()._changed=false}n.length=0},add:function h(i){this._changedObjs.push(i)},_setViewport:function(){var j=g.domLayer._div.style,i=g.viewport;j.transform=j[g.support.prefix+"Transform"]="scale("+i._scale+", "+i._scale+")";j.left=Math.round(i._x*i._scale)+"px";j.top=Math.round(i._y*i._scale)+"px";j.zIndex=10}}})},{"../core/core.js":7}],25:[function(d,f,b){var g=d("../core/core.js"),a=window.document;g.c("DOM",{_element:null,_cssStyles:null,avoidCss3dTransforms:false,init:function(){var h=g.domLayer;if(!h._div){h.init()}this._drawLayer=h;this._cssStyles={visibility:"",left:"",top:"",width:"",height:"",zIndex:"",opacity:"",transformOrigin:"",transform:""};this._element=a.createElement("div");h._div.appendChild(this._element);this._element.style.position="absolute";this._element.id="ent"+this[0];this.bind("Invalidate",this._invalidateDOM);this.bind("NewComponent",this._updateClass);this.bind("RemoveComponent",this._removeClass);this._invalidateDOM()},remove:function(){this.undraw();this.unbind("NewComponent",this._updateClass);this.unbind("RemoveComponent",this._removeClass);this.unbind("Invalidate",this._invalidateDOM)},getDomId:function(){return this._element.id},_removeClass:function(h){var j=0,l=this.__c,k="";for(j in l){if(j!=h){k+=" "+j}}k=k.substr(1);this._element.className=k},_updateClass:function(){var h=0,k=this.__c,j="";for(h in k){j+=" "+h}j=j.substr(1);this._element.className=j},_invalidateDOM:function(){if(!this._changed){this._changed=true;this._drawLayer.add(this)}},DOM:function(h){if(h&&h.nodeType){this.undraw();this._element=h;this._element.style.position="absolute"}return this},draw:function(){var j=this._element.style,m=this.__coord||[0,0,0,0],l={x:m[0],y:m[1],w:m[2],h:m[3]},k=g.support.prefix,i=[];if(this._cssStyles.visibility!==this._visible){this._cssStyles.visibility=this._visible;if(!this._visible){j.visibility="hidden"}else{j.visibility="visible"}}if(g.support.css3dtransform&&!this.avoidCss3dTransforms){i.push("translate3d("+(~~this._x)+"px,"+(~~this._y)+"px,0)")}else{if(this._cssStyles.left!==this._x){this._cssStyles.left=this._x;j.left=~~(this._x)+"px"}if(this._cssStyles.top!==this._y){this._cssStyles.top=this._y;j.top=~~(this._y)+"px"}}if(this._cssStyles.width!==this._w){this._cssStyles.width=this._w;j.width=~~(this._w)+"px"}if(this._cssStyles.height!==this._h){this._cssStyles.height=this._h;j.height=~~(this._h)+"px"}if(this._cssStyles.zIndex!==this._z){this._cssStyles.zIndex=this._z;j.zIndex=this._z}if(this._cssStyles.opacity!==this._alpha){this._cssStyles.opacity=this._alpha;j.opacity=this._alpha;j[k+"Opacity"]=this._alpha}if(this._mbr){var h=this._origin.x+"px "+this._origin.y+"px";j.transformOrigin=h;j[k+"TransformOrigin"]=h;if(g.support.css3dtransform){i.push("rotateZ("+this._rotation+"deg)")}else{i.push("rotate("+this._rotation+"deg)")}}if(this._flipX){i.push("scaleX(-1)")}if(this._flipY){i.push("scaleY(-1)")}if(this._cssStyles.transform!=i.join(" ")){this._cssStyles.transform=i.join(" ");j.transform=this._cssStyles.transform;j[k+"Transform"]=this._cssStyles.transform}this.trigger("Draw",{style:j,type:"DOM",co:l});return this},undraw:function(){var h=this._element;if(h&&h.parentNode!==null){h.parentNode.removeChild(h)}return this},css:function(l,k){var h,j=this._element,m,i=j.style;if(typeof l==="object"){for(h in l){if(!l.hasOwnProperty(h)){continue}m=l[h];if(typeof m==="number"){m+="px"}i[g.domHelper.camelize(h)]=m}}else{if(k){if(typeof k==="number"){k+="px"}i[g.domHelper.camelize(l)]=k}else{return g.domHelper.getStyle(j,l)}}this.trigger("Invalidate");return this}})},{"../core/core.js":7}],26:[function(b,d,a){var f=b("../core/core.js");f.extend({_pixelartEnabled:false,pixelart:function(g){f._pixelartEnabled=g;f.trigger("PixelartSet",g)}})},{"../core/core.js":7}],27:[function(d,f,b){var h=d("../core/core.js");var g=h.TextureManager=function(j,i){this.gl=j;this.webgl=i;this.max_units=j.getParameter(j.MAX_COMBINED_TEXTURE_IMAGE_UNITS);this.bound_textures=[];this.registered_textures={};this.active=null};g.prototype={reset:function(){var k;for(var j=0;j<this.bound_textures.length;j++){k=this.bound_textures[j];k.unbind()}this.bound_textures=[];this.active=null},makeTexture:function(i,l,n){var m=this.gl,k=this.webgl;var o="texture-(r:"+n+")-"+i;if(typeof this.registered_textures[o]!=="undefined"){return this.registered_textures[o]}var j=new a(this,o);this.registered_textures[o]=j;this.bindTexture(j);j.setImage(l);j.setFilter(k.texture_filter);j.setRepeat(n);return j},smallest:function(){var m=Infinity;var j=null;for(var l=0;l<this.bound_textures.length;l++){var k=this.bound_textures[l];if(k.size<m){m=k.size;j=l}}return j},getAvailableUnit:function(){if(this.bound_textures.length<this.max_units){return this.bound_textures.length}else{return this.smallest()}},bindTexture:function(k){if(k.unit!==null){return}var j=this.getAvailableUnit();if(this.bound_textures[j]){this.unbindTexture(this.bound_textures[j])}this.bound_textures[j]=k;k.bind(j)},unbindTexture:function(i){i.unbind()},setActiveTexture:function(i){if(this.active===i.id){return}this.gl.activeTexture(this.gl[i.name]);this.active=i.unit}};var a=h.TextureWrapper=function(i,j){this.manager=i;this.gl=i.gl;this.glTexture=this.gl.createTexture();this.id=j;this.active=false;this.unit=null;this.powerOfTwo=false};a.prototype={bind:function(i){var j=this.gl;this.unit=i;this.name="TEXTURE"+i;this.manager.setActiveTexture(this);j.bindTexture(j.TEXTURE_2D,this.glTexture)},isActive:function(){return(this.manager.active===this.unit)},unbind:function(){this.unit=null;this.name=null;if(this.isActive()){this.manager.active=null}},setImage:function(i){if(!this.isActive()){throw ("Trying to set image of texture that isn't active")}this.width=i.width;this.height=i.height;this.size=i.width*i.height;this.powerOfTwo=!((Math.log(i.width)/Math.LN2!=Math.floor(Math.log(i.width)/Math.LN2))||(Math.log(i.height)/Math.LN2!=Math.floor(Math.log(i.height)/Math.LN2)));var j=this.gl;j.texImage2D(j.TEXTURE_2D,0,j.RGBA,j.RGBA,j.UNSIGNED_BYTE,i)},setFilter:function(i){if(!this.isActive()){throw ("Trying to set filter of texture that isn't active")}var j=this.gl;j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,i);j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,i)},setRepeat:function(i){if(!this.isActive()){throw ("Trying to set repeat property of texture that isn't active")}if(i&&!this.powerOfTwo){throw ("Can't create a repeating image whose dimensions aren't a power of 2 in WebGL contexts")}var j=this.gl;this.repeatMode=i?j.REPEAT:j.CLAMP_TO_EDGE;j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,this.repeatMode);j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,this.repeatMode)},setToProgram:function(j,k,i){if(this.unit===null){throw ("Trying to use texture not set to a texture unit.")}var l=this.gl;l.useProgram(j);l.uniform1i(l.getUniformLocation(j,k),this.unit);l.uniform2f(l.getUniformLocation(j,i),this.width,this.height)}}},{"../core/core.js":7}],28:[function(b,d,a){var f=b("../core/core.js");f.c("HTML",{inner:"",init:function(){this.requires("2D, DOM")},replace:function(g){this.inner=g;this._element.innerHTML=g;return this},append:function(g){this.inner+=g;this._element.innerHTML+=g;return this},prepend:function(g){this.inner=g+this.inner;this._element.innerHTML=g+this.inner;return this}})},{"../core/core.js":7}],29:[function(d,f,b){var h=d("../core/core.js");var g="attribute vec2 aPosition;\nattribute vec3 aOrientation;\nattribute vec2 aLayer;\nattribute vec2 aTextureCoord;\n\nvarying mediump vec3 vTextureCoord;\n\nuniform vec4 uViewport;\nuniform mediump vec2 uTextureDimensions;\n\nmat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\n\nvoid main() {\n  vec2 pos = aPosition;\n  vec2 entityOrigin = aOrientation.xy;\n  mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));\n  \n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin ;\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );\n  vTextureCoord = vec3(aTextureCoord, aLayer.y);\n}";var a="varying mediump vec3 vTextureCoord;\n  \nuniform sampler2D uSampler;\nuniform mediump vec2 uTextureDimensions;\n\nvoid main(void) {\n  highp vec2 coord =   vTextureCoord.xy / uTextureDimensions;\n  mediump vec4 base_color = texture2D(uSampler, coord);\n  gl_FragColor = vec4(base_color.rgb*base_color.a*vTextureCoord.z, base_color.a*vTextureCoord.z);\n}";var i=[{name:"aPosition",width:2},{name:"aOrientation",width:3},{name:"aLayer",width:2},{name:"aTextureCoord",width:2}];h.c("Image",{_repeat:"repeat",ready:false,init:function(){this.bind("Draw",this._drawImage)},remove:function(){this.unbind("Draw",this._drawImage)},image:function(k,l){this.__image=k;this._repeat=l||"no-repeat";this.img=h.asset(k);if(!this.img){this.img=new Image();h.asset(k,this.img);this.img.src=k;var j=this;this.img.onload=function(){j._onImageLoad()}}else{this._onImageLoad()}this.trigger("Invalidate");return this},_onImageLoad:function(){if(this.has("Canvas")){this._pattern=this._drawContext.createPattern(this.img,this._repeat)}else{if(this.has("WebGL")){this._establishShader("image:"+this.__image,a,g,i);this.program.setTexture(this.webgl.makeTexture(this.__image,this.img,(this._repeat!=="no-repeat")))}}if(this._repeat==="no-repeat"){this.w=this.w||this.img.width;this.h=this.h||this.img.height}this.ready=true;this.trigger("Invalidate")},_drawImage:function(k){if(k.type==="canvas"){if(!this.ready||!this._pattern){return}var j=k.ctx;j.fillStyle=this._pattern;j.save();j.translate(k.pos._x,k.pos._y);j.fillRect(0,0,k.pos._w,k.pos._h);j.restore()}else{if(k.type==="DOM"){if(this.__image){k.style.backgroundImage="url("+this.__image+")";k.style.backgroundRepeat=this._repeat}}else{if(k.type==="webgl"){var l=k.pos;k.program.writeVector("aTextureCoord",0,0,0,l._h,l._w,0,l._w,l._h)}}}}})},{"../core/core.js":7}],30:[function(d,f,b){var g=d("../core/core.js"),a=window.document;g.c("Particles",{init:function(){this._Particles=g.clone(this._Particles);this._Particles.parentEntity=this},particles:function(i){if(!g.support.canvas||g.deactivateParticles){return this}var n,h,l,j,m;n=a.createElement("canvas");n.width=g.viewport.width;n.height=g.viewport.height;n.style.position="absolute";n.style.left="0px";n.style.top="0px";if(i.backgroundLayer===true){g.stage.elem.insertBefore(n,g.stage.elem.firstChild)}else{g.stage.elem.appendChild(n)}h=n.getContext("2d");this._Particles.init(i);this.bind("Remove",function(){g.stage.elem.removeChild(n)}).bind("RemoveComponent",function(o){if(o==="particles"){g.stage.elem.removeChild(n)}});l=this.x+g.viewport.x;j=this.y+g.viewport.y;this._Particles.position=this._Particles.vectorHelpers.create(l,j);var k={x:g.viewport.x,y:g.viewport.y};this.bind("EnterFrame",function(){l=this.x+g.viewport.x;j=this.y+g.viewport.y;this._Particles.viewportDelta={x:g.viewport.x-k.x,y:g.viewport.y-k.y};k={x:g.viewport.x,y:g.viewport.y};this._Particles.position=this._Particles.vectorHelpers.create(l,j);if(typeof g.rectManager.boundingRect=="function"){m=g.rectManager.boundingRect(this._Particles.register);if(m){h.clearRect(m._x,m._y,m._w,m._h)}}else{h.clearRect(0,0,g.viewport.width,g.viewport.height)}this._Particles.update();this._Particles.render(h)});return this},_Particles:{presets:{maxParticles:150,size:18,sizeRandom:4,speed:1,speedRandom:1.2,lifeSpan:29,lifeSpanRandom:7,angle:65,angleRandom:34,startColour:[255,131,0,1],startColourRandom:[48,50,45,0],endColour:[245,35,0,0],endColourRandom:[60,60,60,0],sharpness:20,sharpnessRandom:10,spread:10,duration:-1,fastMode:false,gravity:{x:0,y:0.1},jitter:0,originOffset:{x:0,y:0},particles:[],active:true,particleCount:0,elapsedFrames:0,emissionRate:0,emitCounter:0,particleIndex:0},init:function(h){this.position=this.vectorHelpers.create(0,0);if(typeof h=="undefined"){h={}}for(var i in this.presets){if(typeof h[i]!="undefined"){this[i]=h[i]}else{this[i]=this.presets[i]}}this.emissionRate=this.maxParticles/this.lifeSpan;this.positionRandom=this.vectorHelpers.create(this.spread,this.spread)},addParticle:function(){if(this.particleCount==this.maxParticles){return false}var h=new this.particle(this.vectorHelpers);this.initParticle(h);this.particles[this.particleCount]=h;this.particleCount++;return true},RANDM1TO1:function(){return Math.random()*2-1},initParticle:function(m){m.position.x=g.viewport._scale*(this.position.x+this.originOffset.x+this.positionRandom.x*this.RANDM1TO1());m.position.y=g.viewport._scale*(this.position.y+this.originOffset.y+this.positionRandom.y*this.RANDM1TO1());var l=(this.angle+this.angleRandom*this.RANDM1TO1())*(Math.PI/180);var i=this.vectorHelpers.create(Math.sin(l),-Math.cos(l));var j=this.speed+this.speedRandom*this.RANDM1TO1();m.direction=this.vectorHelpers.multiply(i,j);m.size=g.viewport._scale*(this.size+this.sizeRandom*this.RANDM1TO1());m.size=m.size<0?0:~~m.size;m.timeToLive=this.lifeSpan+this.lifeSpanRandom*this.RANDM1TO1();m.sharpness=this.sharpness+this.sharpnessRandom*this.RANDM1TO1();m.sharpness=m.sharpness>100?100:m.sharpness<0?0:m.sharpness;m.sizeSmall=~~((m.size/200)*m.sharpness);var k=[this.startColour[0]+this.startColourRandom[0]*this.RANDM1TO1(),this.startColour[1]+this.startColourRandom[1]*this.RANDM1TO1(),this.startColour[2]+this.startColourRandom[2]*this.RANDM1TO1(),this.startColour[3]+this.startColourRandom[3]*this.RANDM1TO1()];var h=[this.endColour[0]+this.endColourRandom[0]*this.RANDM1TO1(),this.endColour[1]+this.endColourRandom[1]*this.RANDM1TO1(),this.endColour[2]+this.endColourRandom[2]*this.RANDM1TO1(),this.endColour[3]+this.endColourRandom[3]*this.RANDM1TO1()];m.colour=k;m.deltaColour[0]=(h[0]-k[0])/m.timeToLive;m.deltaColour[1]=(h[1]-k[1])/m.timeToLive;m.deltaColour[2]=(h[2]-k[2])/m.timeToLive;m.deltaColour[3]=(h[3]-k[3])/m.timeToLive},update:function(){if(this.active&&this.emissionRate>0){var k=1/this.emissionRate;this.emitCounter++;while(this.particleCount<this.maxParticles&&this.emitCounter>k){this.addParticle();this.emitCounter-=k}this.elapsedFrames++;if(this.duration!=-1&&this.duration<this.elapsedFrames){this.stop()}}this.particleIndex=0;this.register=[];var i;while(this.particleIndex<this.particleCount){var o=this.particles[this.particleIndex];if(o.timeToLive>0){o.direction=this.vectorHelpers.add(o.direction,this.gravity);o.position=this.vectorHelpers.add(o.position,o.direction);o.position=this.vectorHelpers.add(o.position,this.viewportDelta);if(this.jitter){o.position.x+=this.jitter*this.RANDM1TO1();o.position.y+=this.jitter*this.RANDM1TO1()}o.timeToLive--;var n=o.colour[0]+=o.deltaColour[0];var m=o.colour[1]+=o.deltaColour[1];var h=o.colour[2]+=o.deltaColour[2];var j=o.colour[3]+=o.deltaColour[3];i=[];i.push("rgba("+(n>255?255:n<0?0:~~n));i.push(m>255?255:m<0?0:~~m);i.push(h>255?255:h<0?0:~~h);i.push((j>1?1:j<0?0:j.toFixed(2))+")");o.drawColour=i.join(",");if(!this.fastMode){i[3]="0)";o.drawColourEnd=i.join(",")}this.particleIndex++}else{if(this.particleIndex!=this.particleCount-1){this.particles[this.particleIndex]=this.particles[this.particleCount-1]}this.particleCount--}var l={};l._x=~~o.position.x;l._y=~~o.position.y;l._w=o.size;l._h=o.size;this.register.push(l)}},stop:function(){this.active=false;this.elapsedFrames=0;this.emitCounter=0;this.parentEntity.trigger("ParticleEnd")},render:function(h){for(var l=0,k=this.particleCount;l<k;l++){var n=this.particles[l];var r=n.size;var m=r>>1;if(n.position.x+r<0||n.position.y+r<0||n.position.x-r>g.viewport.width||n.position.y-r>g.viewport.height){continue}var q=~~n.position.x;var p=~~n.position.y;if(this.fastMode){h.fillStyle=n.drawColour}else{var o=h.createRadialGradient(q+m,p+m,n.sizeSmall,q+m,p+m,m);o.addColorStop(0,n.drawColour);o.addColorStop(0.9,n.drawColourEnd);h.fillStyle=o}h.fillRect(q,p,r,r)}},particle:function(h){this.position=h.create(0,0);this.direction=h.create(0,0);this.size=0;this.sizeSmall=0;this.timeToLive=0;this.colour=[];this.drawColour="";this.deltaColour=[];this.sharpness=0},vectorHelpers:{create:function(h,i){return{x:h,y:i}},multiply:function(h,i){h.x*=i;h.y*=i;return h},add:function(i,h){i.x+=h.x;i.y+=h.y;return i}}}})},{"../core/core.js":7}],31:[function(b,d,a){var f=b("../core/core.js");f.c("SpriteAnimation",{_reels:null,_currentReelId:null,_currentReel:null,_isPlaying:false,animationSpeed:1,init:function(){this._reels={}},reel:function(h,l,o,m,g){if(arguments.length===0){return this._currentReelId}if(arguments.length===1&&typeof h==="string"){if(typeof this._reels[h]==="undefined"){throw ("The specified reel "+h+" is undefined.")}this.pauseAnimation();if(this._currentReelId!==h){this._currentReelId=h;this._currentReel=this._reels[h];this._updateSprite();this.trigger("ReelChange",this._currentReel)}return this}var k,j,n;k={id:h,frames:[],currentFrame:0,easing:new f.easing(l),defaultLoops:1};k.duration=k.easing.duration;if(typeof o==="number"){j=o;n=m;if(g>=0){for(;j<o+g;j++){k.frames.push([j,n])}}else{for(;j>o+g;j--){k.frames.push([j,n])}}}else{if(arguments.length===3&&typeof o==="object"){k.frames=o}else{throw"Urecognized arguments. Please see the documentation for 'reel(...)'."}}this._reels[h]=k;return this},animate:function(h,g){var j;if(typeof h==="string"){this.reel(h)}var i=this._currentReel;if(typeof i==="undefined"||i===null){throw ("No reel is specified, and there is no currently active reel.")}this.pauseAnimation();if(typeof g==="undefined"){if(typeof h==="number"){g=h}else{g=1}}i.easing.reset();this.loops(g);this._setFrame(0);this.bind("EnterFrame",this._animationTick);this._isPlaying=true;this.trigger("StartAnimation",i);return this},resumeAnimation:function(){if(this._isPlaying===false&&this._currentReel!==null){this.bind("EnterFrame",this._animationTick);this._isPlaying=true;this._currentReel.easing.resume();this.trigger("StartAnimation",this._currentReel)}return this},pauseAnimation:function(){if(this._isPlaying===true){this.unbind("EnterFrame",this._animationTick);this._isPlaying=false;this._reels[this._currentReelId].easing.pause()}return this},resetAnimation:function(){var g=this._currentReel;if(g===null){throw ("No active reel to reset.")}this.reelPosition(0);g.easing.repeat(g.defaultLoops);return this},loops:function(g){if(arguments.length===0){if(this._currentReel!==null){return this._currentReel.easing.loops}else{return 0}}if(this._currentReel!==null){if(g<0){g=Infinity}this._currentReel.easing.repeat(g);this._currentReel.defaultLoops=g}return this},reelPosition:function(g){if(this._currentReel===null){throw ("No active reel.")}if(arguments.length===0){return this._currentReel.currentFrame}var i,h=this._currentReel.frames.length;if(g==="end"){g=h-1}if(g<1&&g>0){i=g;g=Math.floor(h*i)}else{if(g!==Math.floor(g)){throw ("Position "+g+" is invalid.")}if(g<0){g=h-1+g}i=g/h}g=Math.min(g,h-1);g=Math.max(g,0);this._setProgress(i);this._setFrame(g);return this},_animationTick:function(i){var h=this._reels[this._currentReelId];h.easing.tick(i.dt*this.animationSpeed);var g=h.easing.value();var j=Math.min(Math.floor(h.frames.length*g),h.frames.length-1);this._setFrame(j);if(h.easing.complete===true){this.pauseAnimation();this.trigger("AnimationEnd",this._currentReel)}},_setFrame:function(h){var g=this._currentReel;if(h===g.currentFrame){return}g.currentFrame=h;this._updateSprite();this.trigger("FrameChange",g)},_updateSprite:function(){var g=this._currentReel;var h=g.frames[g.currentFrame];this.sprite(h[0],h[1])},_setProgress:function(h,g){this._currentReel.easing.setProgress(h,g)},isPlaying:function(g){if(!this._isPlaying){return false}if(!g){return !!this._currentReelId}return this._currentReelId===g},getReel:function(g){if(arguments.length===0){if(!this._currentReelId){return null}g=this._currentReelId}return this._reels[g]}})},{"../core/core.js":7}],32:[function(f,g,d){var i=f("../core/core.js");var a="attribute vec2 aPosition;\nattribute vec3 aOrientation;\nattribute vec2 aLayer;\nattribute vec2 aTextureCoord;\n\nvarying mediump vec3 vTextureCoord;\n\nuniform vec4 uViewport;\nuniform mediump vec2 uTextureDimensions;\n\nmat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\n\nvoid main() {\n  vec2 pos = aPosition;\n  vec2 entityOrigin = aOrientation.xy;\n  mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));\n  \n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin ;\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );\n  vTextureCoord = vec3(aTextureCoord, aLayer.y);\n}";var h="varying mediump vec3 vTextureCoord;\n  \nuniform sampler2D uSampler;\nuniform mediump vec2 uTextureDimensions;\n\nvoid main(void) {\n  highp vec2 coord =   vTextureCoord.xy / uTextureDimensions;\n  mediump vec4 base_color = texture2D(uSampler, coord);\n  gl_FragColor = vec4(base_color.rgb*base_color.a*vTextureCoord.z, base_color.a*vTextureCoord.z);\n}";var b=[{name:"aPosition",width:2},{name:"aOrientation",width:3},{name:"aLayer",width:2},{name:"aTextureCoord",width:2}];i.extend({sprite:function(s,m,k,j,n,l,r){var o,B,u,t,v,q,p;if(typeof s==="string"){l=n;n=j;j=m;k=s;s=1;m=1}if(typeof m=="string"){l=n;n=j;j=k;k=m;m=s}if(!l&&n){l=n}n=parseInt(n||0,10);l=parseInt(l||0,10);var A=function(){this.ready=true;this.trigger("Invalidate")};p=i.asset(k);if(!p){p=new Image();p.src=k;i.asset(k,p);p.onload=function(){for(var w in j){i(w).each(A)}}}var z=function(){this.requires("2D, Sprite");this.__trim=[0,0,0,0];this.__image=k;this.__coord=[this.__coord[0],this.__coord[1],this.__coord[2],this.__coord[3]];this.__tile=s;this.__tileh=m;this.__padding=[n,l];this.__padBorder=r;this.sprite(this.__coord[0],this.__coord[1],this.__coord[2],this.__coord[3]);this.img=p;if(this.img.complete&&this.img.width>0){this.ready=true;this.trigger("Invalidate")}this.w=this.__coord[2];this.h=this.__coord[3];if(this.has("WebGL")){this._establishShader(this.__image,h,a,b);this.program.setTexture(this.webgl.makeTexture(this.__image,this.img,false))}};for(o in j){if(!j.hasOwnProperty(o)){continue}B=j[o];i.c(o,{ready:false,__coord:[B[0],B[1],B[2]||1,B[3]||1],init:z})}return this}});i.c("Sprite",{__image:"",__tile:0,__tileh:0,__padding:null,__trim:null,img:null,ready:false,init:function(){this.__trim=[0,0,0,0];this.bind("Draw",this._drawSprite)},remove:function(){this.unbind("Draw",this._drawSprite)},_drawSprite:function(n){var p=n.co,o=n.pos,k=n.ctx;if(n.type==="canvas"){k.drawImage(this.img,p.x,p.y,p.w,p.h,o._x,o._y,o._w,o._h)}else{if(n.type==="DOM"){var m=this._h/p.h,l=this._w/p.w,j=this._element.style,r=j.backgroundColor;if(r==="initial"){r=""}var q=r+" url('"+this.__image+"') no-repeat";if(q!==j.background){j.background=q}j.backgroundPosition="-"+p.x*l+"px -"+p.y*m+"px";if(m!=1||l!=1){j.backgroundSize=(this.img.width*l)+"px "+(this.img.height*m)+"px"}}else{if(n.type==="webgl"){n.program.writeVector("aTextureCoord",p.x,p.y,p.x,p.y+p.h,p.x+p.w,p.y,p.x+p.w,p.y+p.h)}}}},sprite:function(j,m,k,l){this.__coord=this.__coord||[0,0,0,0];this.__coord[0]=j*(this.__tile+this.__padding[0])+(this.__padBorder?this.__padding[0]:0)+this.__trim[0];this.__coord[1]=m*(this.__tileh+this.__padding[1])+(this.__padBorder?this.__padding[1]:0)+this.__trim[1];if(typeof(k)!=="undefined"&&typeof(l)!=="undefined"){this.__coord[2]=this.__trim[2]||k*this.__tile||this.__tile;this.__coord[3]=this.__trim[3]||l*this.__tileh||this.__tileh}this.trigger("Invalidate");return this},crop:function(j,n,l,m){var k=this._mbr||this.pos();this.__trim=[];this.__trim[0]=j;this.__trim[1]=n;this.__trim[2]=l;this.__trim[3]=m;this.__coord[0]+=j;this.__coord[1]+=n;this.__coord[2]=l;this.__coord[3]=m;this._w=l;this._h=m;this.trigger("Invalidate",k);return this}})},{"../core/core.js":7}],33:[function(b,d,a){var f=b("../core/core.js");f.c("Text",{_text:"",defaultSize:"10px",defaultFamily:"sans-serif",defaultVariant:"normal",defaultLineHeight:"normal",ready:true,init:function(){this.requires("2D");this._textFont={type:"",weight:"",size:this.defaultSize,lineHeight:this.defaultLineHeight,family:this.defaultFamily,variant:this.defaultVariant};this.bind("Draw",function(k){var g=this._fontString();if(k.type==="DOM"){var j=this._element,i=j.style;i.color=this._textColor;i.font=g;j.innerHTML=this._text}else{if(k.type==="canvas"){var h=k.ctx;h.save();h.textBaseline="top";h.fillStyle=this._textColor||"rgb(0,0,0)";h.font=g;h.fillText(this._text,k.pos._x,k.pos._y);h.restore()}}})},_getFontHeight:(function(){var g=/([a-zA-Z]+)\b/;var h={px:1,pt:4/3,pc:16,cm:96/2.54,mm:96/25.4,"in":96,em:undefined,ex:undefined};return function(i){var l=parseFloat(i);var j=g.exec(i);var k=j?j[1]:"px";if(h[k]!==undefined){return Math.ceil(l*h[k])}else{return Math.ceil(l)}}})(),text:function(g){if(!(typeof g!=="undefined"&&g!==null)){return this._text}if(typeof(g)=="function"){this._text=g.call(this)}else{this._text=g}if(this.has("Canvas")){this._resizeForCanvas()}this.trigger("Invalidate");return this},_resizeForCanvas:function(){var g=this._drawContext;g.font=this._fontString();this.w=g.measureText(this._text).width;var h=(this._textFont.size||this.defaultSize);this.h=1.1*this._getFontHeight(h)},_fontString:function(){return this._textFont.type+" "+this._textFont.variant+" "+this._textFont.weight+" "+this._textFont.size+" / "+this._textFont.lineHeight+" "+this._textFont.family},textColor:function(g){f.assignColor(g,this);this._textColor="rgba("+this._red+", "+this._green+", "+this._blue+", "+this._strength+")";this.trigger("Invalidate");return this},textFont:function(g,i){if(arguments.length===1){if(typeof g==="string"){return this._textFont[g]}if(typeof g==="object"){for(var h in g){if(h=="family"){this._textFont[h]="'"+g[h]+"'"}else{this._textFont[h]=g[h]}}}}else{this._textFont[g]=i}if(this.has("Canvas")){this._resizeForCanvas()}this.trigger("Invalidate");return this},unselectable:function(){if(this.has("DOM")){this.css({"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:"default"});this.trigger("Invalidate")}return this}})},{"../core/core.js":7}],34:[function(d,f,b){var g=d("../core/core.js"),a=window.document;g.extend({viewport:{clampToEntities:true,_width:0,_height:0,_x:0,_y:0,_scale:1,bounds:null,scroll:function(h,i){this[h]=i;g.trigger("ViewportScroll");g.trigger("InvalidateViewport")},rect_object:{_x:0,_y:0,_w:0,_h:0},rect:function(){this.rect_object._x=-this._x;this.rect_object._y=-this._y;this.rect_object._w=this._width/this._scale;this.rect_object._h=this._height/this._scale;return this.rect_object},pan:(function(){var n={},l,j=false;var q,p,m,k,o;function r(s){o.tick(s.dt);var i=o.value();g.viewport.x=(1-i)*m+i*q;g.viewport.y=(1-i)*k+i*p;g.viewport._clamp();if(o.complete){h();g.trigger("CameraAnimationDone")}}function h(){g.unbind("EnterFrame",r)}g._preBind("StopCamera",h);return function(s,i,u,t){g.trigger("StopCamera");if(s=="reset"){return}m=g.viewport._x;k=g.viewport._y;q=m-s;p=k-i;o=new g.easing(u,t);g.uniqueBind("EnterFrame",r)}})(),follow:(function(){var k,j,h;function l(){var m=g.viewport._scale;g.viewport.scroll("_x",-(this.x+(this.w/2)-(g.viewport.width/2/m)-j*m));g.viewport.scroll("_y",-(this.y+(this.h/2)-(g.viewport.height/2/m)-h*m));g.viewport._clamp()}function i(){if(k){k.unbind("Move",l);k.unbind("ViewportScale",l);k.unbind("ViewportResize",l)}}g._preBind("StopCamera",i);return function(o,n,m){if(!o||!o.has("2D")){return}g.trigger("StopCamera");k=o;j=(typeof n!="undefined")?n:0;h=(typeof m!="undefined")?m:0;o.bind("Move",l);o.bind("ViewportScale",l);o.bind("ViewportResize",l);l.call(o)}})(),centerOn:function(m,h){var o=m.x+g.viewport.x,n=m.y+g.viewport.y,j=m.w/2,i=m.h/2,q=g.viewport.width/2/g.viewport._scale,p=g.viewport.height/2/g.viewport._scale,l=o+j-q,k=n+i-p;g.viewport.pan(l,k,h)},zoom:(function(){function o(){g.unbind("EnterFrame",p)}g._preBind("StopCamera",o);var q,m,n,k,i,j,h,l;function p(t){var s,r;l.tick(t.dt);s=Math.pow(n,l.value());if(n===1){r=l.value()}else{r=(1/s-1)/(1/n-1)}g.viewport.scale(s*q);g.viewport.scroll("_x",k*(1-r)+i*r);g.viewport.scroll("_y",j*(1-r)+h*r);g.viewport._clamp();if(l.complete){o();g.trigger("CameraAnimationDone")}}return function(v,s,r,u,t){if(!v){g.viewport.scale(1);return}if(arguments.length<=2){u=s;s=g.viewport.x-g.viewport.width;r=g.viewport.y-g.viewport.height}g.trigger("StopCamera");q=g.viewport._scale;n=v;m=q*n;k=g.viewport.x;j=g.viewport.y;i=-(s-g.viewport.width/(2*m));h=-(r-g.viewport.height/(2*m));l=new g.easing(u,t);g.uniqueBind("EnterFrame",p)}})(),scale:(function(){return function(h){this._scale=h?h:1;g.trigger("InvalidateViewport");g.trigger("ViewportScale")}})(),mouselook:(function(){var j=false,i=false,k={};old={};function h(){i=false}return function(m,l){if(typeof m=="boolean"){j=m;if(j){g.mouseObjs++}else{g.mouseObjs=Math.max(0,g.mouseObjs-1)}return}if(!j){return}switch(m){case"move":case"drag":if(!i){return}diff={x:l.clientX-k.x,y:l.clientY-k.y};k.x=l.clientX;k.y=l.clientY;g.viewport.x+=diff.x;g.viewport.y+=diff.y;g.viewport._clamp();break;case"start":g.trigger("StopCamera");k.x=l.clientX;k.y=l.clientY;i=true;break;case"stop":i=false;break}}})(),_clamp:function(){if(!this.clampToEntities){return}var h=g.clone(this.bounds)||g.map.boundaries();h.max.x*=this._scale;h.min.x*=this._scale;h.max.y*=this._scale;h.min.y*=this._scale;if(h.max.x-h.min.x>g.viewport.width){if(g.viewport.x<(-h.max.x+g.viewport.width)/this._scale){g.viewport.x=(-h.max.x+g.viewport.width)/this._scale}else{if(g.viewport.x>-h.min.x){g.viewport.x=-h.min.x}}}else{g.viewport.x=-1*(h.min.x+(h.max.x-h.min.x)/2-g.viewport.width/2)}if(h.max.y-h.min.y>g.viewport.height){if(g.viewport.y<(-h.max.y+g.viewport.height)/this._scale){g.viewport.y=(-h.max.y+g.viewport.height)/this._scale}else{if(g.viewport.y>-h.min.y){g.viewport.y=-h.min.y}}}else{g.viewport.y=-1*(h.min.y+(h.max.y-h.min.y)/2-g.viewport.height/2)}},init:function(i,k,p){this._defineViewportProperties();this._x=0;this._y=0;this._scale=1;this.bounds=null;this._width=i||window.innerWidth;this._height=k||window.innerHeight;if(typeof p==="undefined"){p="cr-stage"}var m;if(typeof p==="string"){m=a.getElementById(p)}else{if(typeof HTMLElement!=="undefined"?p instanceof HTMLElement:p instanceof Element){m=p}else{throw new TypeError("stage_elem must be a string or an HTMLElement")}}g.stage={x:0,y:0,fullscreen:false,elem:(m?m:a.createElement("div")),};if(!i&&!k){a.body.style.overflow="hidden";g.stage.fullscreen=true}g.addEvent(this,window,"resize",g.viewport.reload);g.addEvent(this,window,"blur",function(){if(g.settings.get("autoPause")){if(!g._paused){g.pause()}}});g.addEvent(this,window,"focus",function(){if(g._paused&&g.settings.get("autoPause")){g.pause()}});g.settings.register("stageSelectable",function(h){g.stage.elem.onselectstart=h?function(){return true}:function(){return false}});g.settings.modify("stageSelectable",false);g.settings.register("stageContextMenu",function(h){g.stage.elem.oncontextmenu=h?function(){return true}:function(){return false}});g.settings.modify("stageContextMenu",false);g.settings.register("autoPause",function(){});g.settings.modify("autoPause",false);if(!m){a.body.appendChild(g.stage.elem);g.stage.elem.id=p}var l=g.stage.elem.style,o;l.width=this.width+"px";l.height=this.height+"px";l.overflow="hidden";g.bind("ViewportResize",function(){g.trigger("InvalidateViewport")});if(g.mobile){if(typeof l.webkitTapHighlightColor!==undefined){l.webkitTapHighlightColor="rgba(0,0,0,0)"}var n=a.createElement("meta"),j=a.getElementsByTagName("head")[0];n=a.createElement("meta");n.setAttribute("name","apple-mobile-web-app-capable");n.setAttribute("content","yes");j.appendChild(n);g.addEvent(this,g.stage.elem,"touchmove",function(h){h.preventDefault()})}l.position="relative";o=g.domHelper.innerPosition(g.stage.elem);g.stage.x=o.x;g.stage.y=o.y;g.uniqueBind("ViewportResize",this._resize)},_resize:function(){g.stage.elem.style.width=g.viewport.width+"px";g.stage.elem.style.height=g.viewport.height+"px"},_defineViewportProperties:function(){Object.defineProperty(this,"x",{set:function(h){this.scroll("_x",h)},get:function(){return this._x},configurable:true});Object.defineProperty(this,"y",{set:function(h){this.scroll("_y",h)},get:function(){return this._y},configurable:true});Object.defineProperty(this,"width",{set:function(h){this._width=h;g.trigger("ViewportResize")},get:function(){return this._width},configurable:true});Object.defineProperty(this,"height",{set:function(h){this._height=h;g.trigger("ViewportResize")},get:function(){return this._height},configurable:true})},reload:function(){var i=window.innerWidth,j=window.innerHeight,k;if(g.stage.fullscreen){this._width=i;this._height=j;g.trigger("ViewportResize")}k=g.domHelper.innerPosition(g.stage.elem);g.stage.x=k.x;g.stage.y=k.y},reset:function(){g.viewport.mouselook("stop");g.trigger("StopCamera");g.viewport.scroll("_x",0);g.viewport.scroll("_y",0);g.viewport.scale(1)},onScreen:function(h){return g.viewport._x+h._x+h._w>0&&g.viewport._y+h._y+h._h>0&&g.viewport._x+h._x<g.viewport.width&&g.viewport._y+h._y<g.viewport.height},}})},{"../core/core.js":7}],35:[function(d,f,b){var g=d("../core/core.js"),a=window.document;RenderProgramWrapper=function(h,i){this.shader=i;this.context=h;this.array_size=16;this.max_size=1024;this._indexArray=new Uint16Array(6*this.array_size);this._indexBuffer=h.createBuffer()};RenderProgramWrapper.prototype={initAttributes:function(j){this.attributes=j;this._attribute_table={};var l=0;for(var k=0;k<j.length;k++){var h=j[k];this._attribute_table[h.name]=h;h.bytes=h.bytes||Float32Array.BYTES_PER_ELEMENT;h.type=h.type||this.context.FLOAT;h.offset=l;h.location=this.context.getAttribLocation(this.shader,h.name);this.context.enableVertexAttribArray(h.location);l+=h.width}this.stride=l;this._attributeArray=new Float32Array(this.array_size*4*this.stride);this._attributeBuffer=this.context.createBuffer();this._registryHoles=[];this._registrySize=0},growArrays:function(i){if(this.array_size>=this.max_size){return}var j=Math.min(i,this.max_size);var h=new Float32Array(j*4*this.stride);var k=new Uint16Array(6*j);h.set(this._attributeArray);k.set(this._indexArray);this._attributeArray=h;this._indexArray=k;this.array_size=j},registerEntity:function(h){if(this._registryHoles.length===0){if(this._registrySize>=this.max_size){throw ("Number of entities exceeds maximum limit.")}else{if(this._registrySize>=this.array_size){this.growArrays(2*this.array_size)}}h._glBufferIndex=this._registrySize;this._registrySize++}else{h._glBufferIndex=this._registryHoles.pop()}},unregisterEntity:function(h){if(typeof h._glBufferIndex==="number"){this._registryHoles.push(h._glBufferIndex)}h._glBufferIndex=null},resetRegistry:function(){this._maxElement=0;this._registryHoles.length=0},setCurrentEntity:function(h){this.ent_offset=h._glBufferIndex*4;this.ent=h},switchTo:function(){var m=this.context;m.useProgram(this.shader);m.bindBuffer(m.ARRAY_BUFFER,this._attributeBuffer);var h,j=this.attributes;for(var l=0;l<j.length;l++){h=j[l];m.vertexAttribPointer(h.location,h.width,h.type,false,this.stride*h.bytes,h.offset*h.bytes)}var k=this.texture_obj;if(k&&k.unit===null){g.webgl.texture_manager.bindTexture(k)}this.index_pointer=0},setTexture:function(h){if(this.texture_obj!==undefined){return}h.setToProgram(this.shader,"uSampler","uTextureDimensions");this.texture_obj=h},addIndices:function(j){var i=this._indexArray,h=this.index_pointer;i[0+h]=0+j;i[1+h]=1+j;i[2+h]=2+j;i[3+h]=1+j;i[4+h]=2+j;i[5+h]=3+j;this.index_pointer+=6},renderBatch:function(){var h=this.context;h.bindBuffer(h.ARRAY_BUFFER,this._attributeBuffer);h.bufferData(h.ARRAY_BUFFER,this._attributeArray,h.STATIC_DRAW);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this._indexBuffer);h.bufferData(h.ELEMENT_ARRAY_BUFFER,this._indexArray,h.STATIC_DRAW);h.drawElements(h.TRIANGLES,this.index_pointer,h.UNSIGNED_SHORT,0)},setViewportUniforms:function(h){var i=this.context;i.useProgram(this.shader);i.uniform4f(this.shader.viewport,h._x,h._y,h._width/h._scale,h._height/h._scale)},writeVector:function(j,s,p){var q=this._attribute_table[j];var i=this.stride,m=q.offset+this.ent_offset*i,t=q.width;var k=(arguments.length-1);var n=this._attributeArray;for(var h=0;h<4;h++){for(var o=0;o<t;o++){n[m+i*h+o]=arguments[(t*h+o)%k+1]}}}};g.c("WebGL",{init:function(){if(!g.webgl.context){g.webgl.init()}var h=this.webgl=g.webgl;var i=h.context;this._changed=true;this.bind("Change",this._glChange)},remove:function(){this._changed=true;this.unbind(this._glChange);if(this.program){this.program.unregisterEntity(this)}},_glChange:function(){if(this._changed===false){this._changed=true}},drawVars:{type:"webgl",pos:{},ctx:null,coord:[0,0,0,0],co:{x:0,y:0,w:0,h:0}},draw:function(r,p,m,q,k){if(!this.ready){return}if(arguments.length===4){k=q;q=m;m=p;p=r;r=this.webgl.context}var n=this.drawVars.pos;n._x=(this._x+(p||0));n._y=(this._y+(m||0));n._w=(q||this._w);n._h=(k||this._h);var l=this.__coord||[0,0,0,0];var o=this.drawVars.co;o.x=l[0]+(p||0);o.y=l[1]+(m||0);o.w=q||l[2];o.h=k||l[3];if(this._flipX){o.x=o.x+o.w;o.w=-o.w}if(this._flipY){o.y=o.y+o.h;o.h=-o.h}var j=this.webgl.context;this.drawVars.gl=j;var i=this.drawVars.program=this.program;i.setCurrentEntity(this);i.writeVector("aPosition",this._x,this._y,this._x,this._y+this._h,this._x+this._w,this._y,this._x+this._w,this._y+this._h);i.writeVector("aOrientation",this._origin.x+this._x,this._origin.y+this._y,this._rotation*Math.PI/180);i.writeVector("aLayer",this._globalZ,this._alpha);this.trigger("Draw",this.drawVars);i.addIndices(i.ent_offset);return this},_establishShader:function(j,k,i,h){this.program=this.webgl.getProgramWrapper(j,k,i,h);this.program.registerEntity(this);this.ready=true}});g.extend({webgl:{context:null,changed_objects:[],_compileShader:function(k,h){var j=this.context;var i=j.createShader(h);j.shaderSource(i,k);j.compileShader(i);if(!j.getShaderParameter(i,j.COMPILE_STATUS)){throw (j.getShaderInfoLog(i))}return i},_makeProgram:function(h,l){var k=this.context;var i=this._compileShader(h,k.FRAGMENT_SHADER);var j=this._compileShader(l,k.VERTEX_SHADER);var m=k.createProgram();k.attachShader(m,j);k.attachShader(m,i);k.linkProgram(m);if(!k.getProgramParameter(m,k.LINK_STATUS)){throw ("Could not initialise shaders")}m.viewport=k.getUniformLocation(m,"uViewport");return m},programs:{},getProgramWrapper:function(k,h,m,j){if(this.programs[k]===undefined){var l=this._makeProgram(h,m);var i=new RenderProgramWrapper(this.context,l);i.name=k;i.initAttributes(j);i.setViewportUniforms(g.viewport);this.programs[k]=i}return this.programs[k]},makeTexture:function(h,j,k){var i=this;return i.texture_manager.makeTexture(h,j,k)},init:function(){if(!g.support.webgl){g.trigger("NoWebGL");g.stop();return}this.changed_objects=[];var k;k=a.createElement("canvas");k.width=g.viewport.width;k.height=g.viewport.height;k.style.position="absolute";k.style.left="0px";k.style.top="0px";g.stage.elem.appendChild(k);var j;try{j=k.getContext("webgl",{premultipliedalpha:true})||k.getContext("experimental-webgl",{premultipliedalpha:true});j.viewportWidth=k.width;j.viewportHeight=k.height}catch(i){g.trigger("NoWebGL");g.stop();return}this.context=j;this._canvas=k;j.clearColor(0,0,0,0);j.disable(j.DEPTH_TEST);j.blendFunc(j.ONE,j.ONE_MINUS_SRC_ALPHA);j.enable(j.BLEND);var h=this;g.uniqueBind("RenderScene",h.render);g.uniqueBind("ViewportResize",h._resize);g.uniqueBind("InvalidateViewport",function(){h.dirtyViewport=true});g.uniqueBind("PixelartSet",h._setPixelart);h._setPixelart(g._pixelartEnabled);this.dirtyViewport=true;this.texture_manager=new g.TextureManager(j,this)},_resize:function(){var i=g.webgl._canvas;i.width=g.viewport.width;i.height=g.viewport.height;var h=g.webgl.context;h.viewportWidth=i.width;h.viewportHeight=i.height},_setPixelart:function(h){var i=g.webgl.context;if(h){g.webgl.texture_filter=i.NEAREST}else{g.webgl.texture_filter=i.LINEAR}},zsort:function(i,h){return i._globalZ-h._globalZ},visible_gl:[],render:function(v){v=v||g.viewport.rect();var k=g.webgl,r=k.context;r.viewport(0,0,r.viewportWidth,r.viewportHeight);r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);var n=k.programs;if(k.dirtyViewport){for(var s in n){n[s].setViewportUniforms(g.viewport)}k.dirtyViewport=false}var j=g.map.search(v),p=0,o=j.length,u;var t=k.visible_gl;t.length=0;for(p=0;p<o;p++){u=j[p];if(u._visible&&u.__c.WebGL&&u.program){t.push(u)}}t.sort(k.zsort);o=t.length;var m=0;var h=null;for(p=0;p<o;p++){u=t[p];if(h!==u.program){if(h!==null){h.renderBatch()}h=u.program;h.index_pointer=0;h.switchTo()}u.draw();u._changed=false}if(h!==null){h.renderBatch()}}}})},{"../core/core.js":7}],36:[function(b,d,a){var f=b("../core/core.js");f.extend({diamondIso:{_tile:{width:0,height:0},getTileDimensions:function(){return{w:this._tile.width,h:this._tile.height}},_map:{width:0,height:0},_origin:{x:0,y:0},_tiles:[],getTile:function(g,i,h){return this._tiles[g][i][h]},init:function(h,n,p,l,g,o){this._tile.width=parseInt(h,10);this._tile.height=parseInt(n,10)||parseInt(h,10)/2;this._tile.r=this._tile.width/this._tile.height;this._map.width=parseInt(p,10);this._map.height=parseInt(l,10)||parseInt(p,10);for(var m=0;m<p;m++){this._tiles[m]=Array();for(var k=0;k<l;k++){this._tiles[m][k]=Array()}}this.x=parseInt(g,10)||0;this.y=parseInt(o,10)||0;this.layerZLevel=(p+l+1);return this},place:function(h,n,l,k){var m=this.pos2px(n,l);var p=h.tileHeight;var o=h.h/this._tile.height;h.x=m.x;h.y=m.y-(o-2)*this._tile.height-this._tile.height*k;h.z=this.getZAtLoc(n,l,k);for(var j=0;j<=o-2;j++){var g=this._tiles[n][l][k+j];if(g&&g!==h){g.destroy()}this._tiles[n][l][k+j]=h}return this},detachTile:function(m){for(var k=0;k<this._map.width;k++){for(var j=0;j<this._map.height;j++){var g=this._tiles[k][j].length;for(var h=0;h<g;h++){if(this._tiles[k][j][h]&&m===this._tiles[k][j][h]){tHeight=m.h/this._tile.height;for(var l=0;l<tHeight;l++){this._tiles[k][j][h+l]=undefined}return{x:k,y:j,z:h}}}}}return false},centerAt:function(g,i){var h=this.pos2px(g,i);f.viewport.x=-h.x+f.viewport.width/2-this._tile.width;f.viewport.y=-h.y+f.viewport.height/2},getZAtLoc:function(g,i,h){return this.layerZLevel*h+g+i},pos2px:function(g,h){return{x:this.x+((g-h-1)*this._tile.width/2),y:this.y+((g+h)*this._tile.height/2)}},px2pos:function(i,h){var l=(h-this.y)/this._tile.height;var j=(i-this.x)/this._tile.width;var g=l+j;var k=l-j;inX=g>0&&g<this._map.width;inY=k>0&&k<this._map.height;if(!inX||!inY){return undefined}return{x:~~g,y:~~k}},getOverlappingTiles:function(r,n){var o=this.px2pos(r,n);var s=[];var p=~~o.x;var m=~~o.y;var h=this._map.width-p;var g=this._map.height-m;var q=Math.min(h,g);var k=this._tiles[p][m][1];if(k){s.push(k)}for(var j=1;j<q;j++){var l=this._tiles[p+j][m+j][j];if(l){s.push(l)}}return s},polygon:function(k){k.requires("Collision");var h=0,g=0;var i=[h-0,k.h-g-this._tile.height/2,h-this._tile.width/2,k.h-g-0,h-this._tile.width,k.h-g-this._tile.height/2,h-this._tile.width/2,k.h-g-this._tile.height];var j=new f.polygon(i);return j}}})},{"../core/core.js":7}],37:[function(b,d,a){var f=b("../core/core.js");f.extend({isometric:{_tile:{width:0,height:0},_elements:{},_pos:{x:0,y:0},_z:0,size:function(h,g){this._tile.width=h;this._tile.height=g>0?g:h/2;return this},place:function(g,k,i,h){var j=this.pos2px(g,k);j.top-=i*(this._tile.height/2);h.attr({x:j.left+f.viewport._x,y:j.top+f.viewport._y}).z+=i;return this},pos2px:function(g,h){return{left:g*this._tile.width+(h&1)*(this._tile.width/2),top:h*this._tile.height/2}},px2pos:function(h,g){return{x:-Math.ceil(-h/this._tile.width-(g&1)*0.5),y:g/this._tile.height*2}},centerAt:function(h,i){if(typeof h=="number"&&typeof i=="number"){var g=this.pos2px(h,i);f.viewport._x=-g.left+f.viewport.width/2-this._tile.width/2;f.viewport._y=-g.top+f.viewport.height/2-this._tile.height/2;return this}else{return{top:-f.viewport._y+f.viewport.height/2-this._tile.height/2,left:-f.viewport._x+f.viewport.width/2-this._tile.width/2}}},area:function(){var g=this.centerAt();var i=this.px2pos(-g.left+f.viewport.width/2,-g.top+f.viewport.height/2);var h=this.px2pos(-g.left-f.viewport.width/2,-g.top-f.viewport.height/2);return{x:{start:i.x,end:h.x},y:{start:i.y,end:h.y}}}}})},{"../core/core.js":7}],38:[function(d,f,b){var g=d("../core/core.js"),a=window.document;g.extend({audio:{sounds:{},supported:null,codecs:{ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',webma:'audio/webm; codecs="vorbis"',mp3:'audio/mpeg; codecs="mp3"',m4a:'audio/mp4; codecs="mp4a.40.2"'},volume:1,muted:false,paused:false,playCheck:null,_canPlay:function(){this.supported={};if(!g.support.audio){return}var k=this.audioElement(),j;for(var h in this.codecs){j=k.canPlayType(this.codecs[h]);if(j!==""&&j!=="no"){this.supported[h]=true}else{this.supported[h]=false}}},supports:function(h){if(this.supported===null){this._canPlay()}if(this.supported[h]){return true}else{return false}},audioElement:function(){return typeof Audio!=="undefined"?new Audio(""):a.createElement("audio")},create:function(k,j){var h=j.substr(j.lastIndexOf(".")+1).toLowerCase();if(!this.supports(h)){return false}var i=this.audioElement();i.id=k;i.preload="auto";i.volume=g.audio.volume;i.src=j;g.asset(j,i);this.sounds[k]={obj:i,played:0,volume:g.audio.volume};return this.sounds[k]},add:function(m,j){if(!g.support.audio){return}var l,h;if(arguments.length===1&&typeof m==="object"){for(var k in m){for(l in m[k]){h=g.audio.create(k,m[k][l]);if(h){break}}}}if(typeof m==="string"){if(typeof j==="string"){h=g.audio.create(m,j)}if(typeof j==="object"){for(l in j){h=g.audio.create(m,j[l]);if(h){break}}}}return h},play:function(m,k,j){if(k===0||!g.support.audio||!this.sounds[m]){return}var i=this.sounds[m];var l=this.getOpenChannel();if(!l){return null}l.id=m;l.repeat=k;var h=l.obj;l.volume=i.volume=i.obj.volume=j||g.audio.volume;h.volume=i.volume;h.src=i.obj.src;if(this.muted){h.volume=0}h.play();i.played++;l.onEnd=function(){if(i.played<l.repeat||k==-1){if(this.currentTime){this.currentTime=0}this.play();i.played++}else{l.active=false;this.pause();this.removeEventListener("ended",l.onEnd,true);this.currentTime=0;g.trigger("SoundComplete",{id:l.id})}};h.addEventListener("ended",l.onEnd,true);return h},maxChannels:7,setChannels:function(h){this.maxChannels=h;if(h<this.channels.length){this.channels.length=h}},channels:[],getOpenChannel:function(){for(var h=0;h<this.channels.length;h++){var j=this.channels[h];if(j.active===false||j.obj.ended&&j.repeat<=this.sounds[j.id].played){j.active=true;return j}}if(h<this.maxChannels){var k={obj:this.audioElement(),active:true,_is:function(i){return this.id===i&&this.active}};this.channels.push(k);return k}return null},remove:function(m){if(!g.support.audio){return}var l,j,h=g.paths().audio;if(!m){for(var k in this.sounds){l=this.sounds[k];j=l.obj.src.split("/").pop();g.audio.stop(m);delete g.assets[h+j];delete g.assets[l.obj.src];delete g.audio.sounds[m]}return}if(!this.sounds[m]){return}l=this.sounds[m];j=l.obj.src.split("/").pop();g.audio.stop(m);delete g.assets[h+j];delete g.assets[l.obj.src];delete g.audio.sounds[m]},stop:function(j){if(!g.support.audio){return}for(var h in this.channels){c=this.channels[h];if((!j&&c.active)||c._is(j)){c.active=false;c.obj.pause()}}return},_mute:function(j){if(!g.support.audio){return}var k;for(var h in this.channels){k=this.channels[h];k.obj.volume=j?0:k.volume}this.muted=j},toggleMute:function(){if(!this.muted){this._mute(true)}else{this._mute(false)}},mute:function(){this._mute(true)},unmute:function(){this._mute(false)},pause:function(k){if(!g.support.audio||!k||!this.sounds[k]){return}var j;for(var h in this.channels){j=this.channels[h];if(j._is(k)&&!j.obj.paused){j.obj.pause()}}},unpause:function(k){if(!g.support.audio||!k||!this.sounds[k]){return}var j;for(var h in this.channels){j=this.channels[h];if(j._is(k)&&j.obj.paused){j.obj.play()}}},togglePause:function(k){if(!g.support.audio||!k||!this.sounds[k]){return}var j;for(var h in this.channels){j=this.channels[h];if(j._is(k)){if(j.obj.paused){j.obj.play()}else{j.obj.pause()}}}},isPlaying:function(j){if(!g.support.audio){return false}for(var h in this.channels){if(this.channels[h]._is(j)){return true}}return false}}})},{"../core/core.js":7}],39:[function(d,a,g){var i=d("../core/core.js"),l=d("./spatial-grid.js");i.map=new l();var h=Math,k=h.cos,b=h.sin,n=h.PI,j=n/180;i.c("2D",{_x:0,_y:0,_w:0,_h:0,_z:0,_rotation:0,_alpha:1,_visible:true,_globalZ:null,_origin:null,_mbr:null,_entry:null,_children:null,_parent:null,_changed:false,_2D_property_definitions:{x:{set:function(o){this._attr("_x",o)},get:function(){return this._x},configurable:true,enumerable:true},_x:{enumerable:false},y:{set:function(o){this._attr("_y",o)},get:function(){return this._y},configurable:true,enumerable:true},_y:{enumerable:false},w:{set:function(o){this._attr("_w",o)},get:function(){return this._w},configurable:true,enumerable:true},_w:{enumerable:false},h:{set:function(o){this._attr("_h",o)},get:function(){return this._h},configurable:true,enumerable:true},_h:{enumerable:false},z:{set:function(o){this._attr("_z",o)},get:function(){return this._z},configurable:true,enumerable:true},_z:{enumerable:false},rotation:{set:function(o){this._attr("_rotation",o)},get:function(){return this._rotation},configurable:true,enumerable:true},_rotation:{enumerable:false},alpha:{set:function(o){this._attr("_alpha",o)},get:function(){return this._alpha},configurable:true,enumerable:true},_alpha:{enumerable:false},visible:{set:function(o){this._attr("_visible",o)},get:function(){return this._visible},configurable:true,enumerable:true},_visible:{enumerable:false}},_define2DProperties:function(){for(var o in this._2D_property_definitions){Object.defineProperty(this,o,this._2D_property_definitions[o])}},init:function(){this._globalZ=this[0];this._origin={x:0,y:0};this._bx1=0;this._bx2=0;this._by1=0;this._by2=0;this._children=[];this._define2DProperties();this._entry=i.map.insert(this);this.bind("Move",function(p){var o=this._cbr||this._mbr||this;this._entry.update(o);if(this._children.length>0){this._cascade(p)}});this.bind("Rotate",function(p){var o=this._cbr||this._mbr||this;this._entry.update(o);if(this._children.length>0){this._cascade(p)}});this.bind("Remove",function(){if(this._children){for(var o=0;o<this._children.length;o++){delete this._children[o]._parent;if(this._children[o].destroy){this._children[o].destroy()}}this._children=[]}if(this._parent){this._parent.detach(this)}i.map.remove(this);this.detach()})},offsetBoundary:function(p,r,o,q){if(arguments.length===1){r=o=q=p}this._bx1=p;this._bx2=o;this._by1=r;this._by2=q;this.trigger("BoundaryOffset");this._calculateMBR();return this},_calculateMBR:function(){var D=this._origin.x+this._x,B=this._origin.y+this._y,P=-this._rotation*j;var s=this._x-this._bx1-D,o=this._x+this._w+this._bx2-D,F=this._y-this._by1-B,E=this._y+this._h+this._by2-B;var C=Math.cos(P),I=Math.sin(P);C=(C<1e-10&&C>-1e-10)?0:C;I=(I<1e-10&&I>-1e-10)?0:I;var N=s*C+F*I,x=-s*I+F*C,M=o*C+F*I,v=-o*I+F*C,L=o*C+E*I,t=-o*I+E*C,K=s*C+E*I,p=-s*I+E*C,A=Math.floor(Math.min(N,M,L,K)+D),z=Math.floor(Math.min(x,v,t,p)+B),y=Math.ceil(Math.max(N,M,L,K)+D),w=Math.ceil(Math.max(x,v,t,p)+B);if(!this._mbr){this._mbr={_x:A,_y:z,_w:y-A,_h:w-z}}else{this._mbr._x=A;this._mbr._y=z;this._mbr._w=y-A;this._mbr._h=w-z}if(this._cbr){var J=this._cbr;var u=J.cx,q=J.cy,H=J.r;var G=D+(u+this._x-D)*C+(q+this._y-B)*I;var O=B-(u+this._x-D)*I+(q+this._y-B)*C;J._x=Math.min(G-H,A);J._y=Math.min(O-H,z);J._w=Math.max(G+H,y)-J._x;J._h=Math.max(O+H,w)-J._y}},_rotate:function(r){var s=-1*(r%360);var x=this._rotation-r;if(x===0){return}else{this._rotation=r}var p=s*j,w={x:this._origin.x+this._x,y:this._origin.y+this._y};this._calculateMBR();var u=x*j,t=Math.cos(u),q=Math.sin(u);this.trigger("Rotate",{cos:(-1e-10<t&&t<1e-10)?0:t,sin:(-1e-10<q&&q<1e-10)?0:q,deg:x,rad:u,o:w})},area:function(){return this._w*this._h},intersect:function(o,t,p,q){var r,s=this._mbr||this;if(typeof o==="object"){r=o}else{r={_x:o,_y:t,_w:p,_h:q}}return s._x<r._x+r._w&&s._x+s._w>r._x&&s._y<r._y+r._h&&s._y+s._h>r._y},within:function(o,t,p,q){var r,s=this._mbr||this;if(typeof o==="object"){r=o}else{r={_x:o,_y:t,_w:p,_h:q}}return r._x<=s._x&&r._x+r._w>=s._x+s._w&&r._y<=s._y&&r._y+r._h>=s._y+s._h},contains:function(o,t,p,q){var r,s=this._mbr||this;if(typeof o==="object"){r=o}else{r={_x:o,_y:t,_w:p,_h:q}}return r._x>=s._x&&r._x+r._w<=s._x+s._w&&r._y>=s._y&&r._y+r._h<=s._y+s._h},pos:function(o){o=o||{};o._x=(this._x);o._y=(this._y);o._w=(this._w);o._h=(this._h);return o},mbr:function(o){o=o||{};if(!this._mbr){return this.pos(o)}else{o._x=(this._mbr._x);o._y=(this._mbr._y);o._w=(this._mbr._w);o._h=(this._mbr._h);return o}},isAt:function(o,q){if(this.mapArea){return this.mapArea.containsPoint(o,q)}else{if(this.map){return this.map.containsPoint(o,q)}}var p=this._mbr||this;return p._x<=o&&p._x+p._w>=o&&p._y<=q&&p._y+p._h>=q},move:function(o,p){if(o.charAt(0)==="n"){this.y-=p}if(o.charAt(0)==="s"){this.y+=p}if(o==="e"||o.charAt(1)==="e"){this.x+=p}if(o==="w"||o.charAt(1)==="w"){this.x-=p}return this},shift:function(o,r,p,q){if(o){this.x+=o}if(r){this.y+=r}if(p){this.w+=p}if(q){this.h+=q}return this},_cascade:function(t){if(!t){return}var s=0,p=this._children,q=p.length,r;if(("cos" in t)||("sin" in t)){for(;s<q;++s){r=p[s];if("rotate" in r){r.rotate(t)}}}else{var w=this._x-t._x,v=this._y-t._y,o=this._w-t._w,u=this._h-t._h;for(;s<q;++s){r=p[s];r.shift(w,v,o,u)}}},attach:function(){var q=0,o=arguments,p=arguments.length,r;for(;q<p;++q){r=o[q];if(r._parent){r._parent.detach(r)}r._parent=this;this._children.push(r)}return this},detach:function(p){var o;if(!p){for(o=0;o<this._children.length;o++){this._children[o]._parent=null}this._children=[];return this}for(o=0;o<this._children.length;o++){if(this._children[o]==p){this._children.splice(o,1)}}p._parent=null;return this},origin:function(o,q){if(typeof o==="string"){if(o==="centre"||o==="center"||o.indexOf(" ")===-1){o=this._w/2;q=this._h/2}else{var p=o.split(" ");if(p[0]==="top"){q=0}else{if(p[0]==="bottom"){q=this._h}else{if(p[0]==="middle"||p[1]==="center"||p[1]==="centre"){q=this._h/2}}}if(p[1]==="center"||p[1]==="centre"||p[1]==="middle"){o=this._w/2}else{if(p[1]==="left"){o=0}else{if(p[1]==="right"){o=this._w}}}}}this._origin.x=o;this._origin.y=q;return this},flip:function(o){o=o||"X";if(!this["_flip"+o]){this["_flip"+o]=true;this.trigger("Invalidate")}return this},unflip:function(o){o=o||"X";if(this["_flip"+o]){this["_flip"+o]=false;this.trigger("Invalidate")}return this},rotate:function(q){var o,p;o=(this._x+this._origin.x-q.o.x)*q.cos+(this._y+this._origin.y-q.o.y)*q.sin+(q.o.x-this._origin.x);p=(this._y+this._origin.y-q.o.y)*q.cos-(this._x+this._origin.x-q.o.x)*q.sin+(q.o.y-this._origin.y);this._attr("_rotation",this._rotation-q.deg);this._attr("_x",o);this._attr("_y",p)},_attr:function(q,s){if(this[q]===s){return}var o=i.rectManager._pool.copy(this);var t;if(q==="_rotation"){this._rotate(s)}else{if(q==="_z"){var r=s<<0;s=s==r?r:r+1;this._globalZ=s*100000+this[0];this[q]=s;this.trigger("Reorder")}else{if(q==="_x"||q==="_y"){t=this._mbr;if(t){t[q]-=this[q]-s;if(this._cbr){this._cbr[q]-=this[q]-s}}this[q]=s;this.trigger("Move",o)}else{if(q==="_h"||q==="_w"){t=this._mbr;var p=this[q];this[q]=s;if(t){this._calculateMBR()}if(q==="_w"){this.trigger("Resize",{axis:"w",amount:s-p})}else{if(q==="_h"){this.trigger("Resize",{axis:"h",amount:s-p})}}this.trigger("Move",o)}}}}this[q]=s;this.trigger("Invalidate");i.rectManager._pool.recycle(o)}});i.c("Supportable",{_ground:null,_groundComp:null,canLand:true,init:function(){this.requires("2D");this.__area={_x:0,_y:0,_w:0,_h:0};this.defineField("ground",function(){return this._ground},function(o){})},remove:function(o){this.unbind("EnterFrame",this._detectGroundTick)},startGroundDetection:function(o){if(o){this._groundComp=o}this.uniqueBind("EnterFrame",this._detectGroundTick);return this},stopGroundDetection:function(){this.unbind("EnterFrame",this._detectGroundTick);return this},_detectGroundTick:function(){var o=this._groundComp,w=this._ground,y=i.rectManager.overlap;var x=this._cbr||this._mbr||this,p=this.__area;p._x=x._x;p._y=x._y+1;p._w=x._w;p._h=x._h;if(w){var q=w._cbr||w._mbr||w;if(!(w.__c[o]&&y(q,p))){this._ground=null;this.trigger("LiftedOffGround",w);w=null}}if(!w){var u,v,t=i.map.search(p,false),s=0,r=t.length;for(;s<r;++s){u=t[s];v=u._cbr||u._mbr||u;if(u!==this&&u.__c[o]&&y(v,p)){this.canLand=true;this.trigger("CheckLanding",u);if(this.canLand){this._ground=w=u;this.y=u._y-this._h;this.trigger("LandedOnGround",w);break}}}}}});i.c("GroundAttacher",{_groundAttach:function(o){o.attach(this)},_groundDetach:function(o){o.detach(this)},init:function(){this.requires("Supportable");this.bind("LandedOnGround",this._groundAttach);this.bind("LiftedOffGround",this._groundDetach)},remove:function(o){this.unbind("LandedOnGround",this._groundAttach);this.unbind("LiftedOffGround",this._groundDetach)}});i.c("Gravity",{_gravityConst:500,init:function(){this.requires("2D, Supportable, Motion");this.bind("LiftedOffGround",this._startGravity);this.bind("LandedOnGround",this._stopGravity)},remove:function(o){this.unbind("LiftedOffGround",this._startGravity);this.unbind("LandedOnGround",this._stopGravity)},_gravityCheckLanding:function(o){if(this._dy<0){this.canLand=false}},gravity:function(o){this.bind("CheckLanding",this._gravityCheckLanding);this.startGroundDetection(o);this._startGravity();return this},antigravity:function(){this._stopGravity();this.stopGroundDetection();this.unbind("CheckLanding",this._gravityCheckLanding);return this},gravityConst:function(o){if(this._gravityActive){this.ay-=this._gravityConst;this.ay+=o}this._gravityConst=o;return this},_startGravity:function(){this._gravityActive=true;this.ay+=this._gravityConst},_stopGravity:function(){this.ay=0;this.vy=0;this._gravityActive=false}});var m=function(q,s,u,t){var r=s+u;var o="_"+r;var p={key:"",oldValue:0};if(t){i.defineField(q,r,function(){return this[o]},function(w){var v=this[o];if(w!==v){this[o]=w;p.key=r;p.oldValue=v;this.trigger("MotionChange",p)}})}else{i.defineField(q,r,function(){return this[o]},function(v){})}Object.defineProperty(q,o,{value:0,writable:true,enumerable:false,configurable:false})};var f=function(s,t,v,r){var p=t+"x",u=t+"y",q="_"+p,o="_"+u;if(v){i.defineField(r,"x",function(){return s[q]},function(w){s[p]=w});i.defineField(r,"y",function(){return s[o]},function(w){s[u]=w})}else{i.defineField(r,"x",function(){return s[q]},function(w){});i.defineField(r,"y",function(){return s[o]},function(w){})}if(Object.seal){Object.seal(r)}return r};i.c("AngularMotion",{_vrotation:0,_arotation:0,_drotation:0,init:function(){this.requires("2D");m(this,"v","rotation",true);m(this,"a","rotation",true);m(this,"d","rotation",false);this.__oldRotationDirection=0;this.bind("EnterFrame",this._angularMotionTick)},remove:function(o){this.unbind("EnterFrame",this._angularMotionTick)},resetAngularMotion:function(){this._drotation=0;this.vrotation=0;this.arotation=0;return this},_angularMotionTick:function(t){var u=t.dt/1000;var p=this._rotation,o=this._vrotation,q=this._arotation;var r=p+o*u+0.5*q*u*u;this.vrotation=o+q*u;var s=this._vrotation,v=s?(s<0?-1:1):0;if(this.__oldRotationDirection!==v){this.__oldRotationDirection=v;this.trigger("NewRotationDirection",v)}this._drotation=r-p;if(this._drotation!==0){this.rotation=r;this.trigger("Rotated",p)}}});i.c("Motion",{_vx:0,_vy:0,_ax:0,_ay:0,_dx:0,_dy:0,init:function(){this.requires("2D");m(this,"v","x",true);m(this,"v","y",true);this._velocity=f(this,"v",true,new i.math.Vector2D());m(this,"a","x",true);m(this,"a","y",true);this._acceleration=f(this,"a",true,new i.math.Vector2D());m(this,"d","x",false);m(this,"d","y",false);this._motionDelta=f(this,"d",false,new i.math.Vector2D());this.__movedEvent={axis:"",oldValue:0};this.__oldDirection={x:0,y:0};this.bind("EnterFrame",this._linearMotionTick)},remove:function(o){this.unbind("EnterFrame",this._linearMotionTick)},resetMotion:function(){this.vx=0;this.vy=0;this.ax=0;this.ay=0;this._dx=0;this._dy=0;return this},motionDelta:function(){return this._motionDelta},velocity:function(){return this._velocity},acceleration:function(){return this._acceleration},_linearMotionTick:function(x){var q=x.dt/1000;var z=this._x,w=this._vx,p=this._ax,y=this._y,v=this._vy,D=this._ay;var o=z+w*q+0.5*p*q*q;var C=y+v*q+0.5*D*q*q;this.vx=w+p*q;this.vy=v+D*q;var B=this.__oldDirection,s=this._vx,u=s?(s<0?-1:1):0,r=this._vy,t=r?(r<0?-1:1):0;if(B.x!==u||B.y!==t){B.x=u;B.y=t;this.trigger("NewDirection",B)}var A=this.__movedEvent;this._dx=o-z;this._dy=C-y;if(this._dx!==0){this.x=o;A.axis="x";A.oldValue=z;this.trigger("Moved",A)}if(this._dy!==0){this.y=C;A.axis="y";A.oldValue=y;this.trigger("Moved",A)}}});i.polygon=function(o){if(arguments.length>1){o=Array.prototype.slice.call(arguments,0)}this.points=o};i.polygon.prototype={containsPoint:function(o,v){var t=this.points,q=t.length/2,s,r,u=false;for(s=0,r=q-1;s<q;r=s++){if(((t[2*s+1]>v)!=(t[2*r+1]>v))&&(o<(t[2*r]-t[2*s])*(v-t[2*s+1])/(t[2*r+1]-t[2*s+1])+t[2*s])){u=!u}}return u},shift:function(o,t){var r=0,s=this.points,q=s.length;for(;r<q;r+=2){s[r]+=o;s[r+1]+=t}},clone:function(){return new i.polygon(this.points.slice(0))},rotate:function(t){var r=0,s=this.points,q=s.length,o,u;for(;r<q;r+=2){o=t.o.x+(s[r]-t.o.x)*t.cos+(s[r+1]-t.o.y)*t.sin;u=t.o.y-(s[r]-t.o.x)*t.sin+(s[r+1]-t.o.y)*t.cos;s[r]=o;s[r+1]=u}}};i.circle=function(p,s,o){this.x=p;this.y=s;this.radius=o;this.points=[];var r;for(var q=0;q<16;q+=2){r=q*Math.PI/8;this.points[q]=this.x+(Math.sin(r)*o);this.points[q+1]=this.y+(Math.cos(r)*o)}};i.circle.prototype={containsPoint:function(q,t){var p=this.radius,s=Math.sqrt,r=this.x-q,o=this.y-t;return(r*r+o*o)<(p*p)},shift:function(o,u){this.x+=o;this.y+=u;var r=0,t=this.points,q=t.length,s;for(;r<q;r+=2){t[r]+=o;t[r+1]+=u}},rotate:function(){}};i.matrix=function(o){this.mtx=o;this.width=o[0].length;this.height=o.length};i.matrix.prototype={x:function(p){if(this.width!=p.height){return}var o=[];for(var s=0;s<this.height;s++){o[s]=[];for(var r=0;r<p.width;r++){var t=0;for(var q=0;q<this.width;q++){t+=this.mtx[s][q]*p.mtx[q][r]}o[s][r]=t}}return new i.matrix(o)},e:function(p,o){if(p<1||p>this.mtx.length||o<1||o>this.mtx[0].length){return null}return this.mtx[p-1][o-1]}}},{"../core/core.js":7,"./spatial-grid.js":43}],40:[function(d,f,b){var g=d("../core/core.js"),a=Math.PI/180;g.c("Collision",{init:function(){this.requires("2D");this._collisionData={};this.collision()},remove:function(){this._cbr=null;this.unbind("Resize",this._resizeMap);this.unbind("Resize",this._checkBounds)},collision:function(i){this.unbind("Resize",this._resizeMap);this.unbind("Resize",this._checkBounds);if(!i){i=new g.polygon([0,0,this._w,0,this._w,this._h,0,this._h]);this.bind("Resize",this._resizeMap);this._cbr=null}else{if(arguments.length>1){var h=Array.prototype.slice.call(arguments,0);i=new g.polygon(h)}else{if(i.constructor===Array){i=new g.polygon(i.slice())}else{i=i.clone()}}this._findBounds(i.points)}if(this.rotation){i.rotate({cos:Math.cos(-this.rotation*a),sin:Math.sin(-this.rotation*a),o:{x:this._origin.x,y:this._origin.y}})}this.map=i;this.attach(this.map);this.map.shift(this._x,this._y);this.trigger("NewHitbox",i);return this},_findBounds:function(n){var h=Infinity,p=-Infinity,q=Infinity,o=-Infinity;var j=n.length;for(var m=0;m<j;m+=2){if(n[m]<h){h=n[m]}if(n[m]>p){p=n[m]}if(n[m+1]<q){q=n[m+1]}if(n[m+1]>o){o=n[m+1]}}var k={cx:(h+p)/2,cy:(q+o)/2,r:Math.sqrt((p-h)*(p-h)+(o-q)*(o-q))/2};if(h>=0&&q>=0){this._checkBounds=function(){if(this._cbr===null&&this._w<p||this._h<o){this._cbr=k;this._calculateMBR()}else{if(this._cbr){this._cbr=null;this._calculateMBR()}}};this.bind("Resize",this._checkBounds)}if(h>=0&&q>=0&&p<=this._w&&o<=this._h){this._cbr=null;return false}else{this._cbr=k;this._calculateMBR();return true}},_resizeMap:function(l){var j,i,h=this.rotation*a,k=this.map.points;if(l.axis==="w"){if(h){j=l.amount*Math.cos(h);i=l.amount*Math.sin(h)}else{j=l.amount;i=0}k[2]+=j;k[3]+=i}else{if(h){i=l.amount*Math.cos(h);j=-l.amount*Math.sin(h)}else{j=0;i=l.amount}k[6]+=j;k[7]+=i}k[4]+=j;k[5]+=i},hit:function(s){var j=this._cbr||this._mbr||this,o=g.map.search(j,false),p=0,m=o.length,w={},h,n,q,v,u=g.rectManager.overlap,r=("map" in this&&"containsPoint" in this.map),k=[];if(!m){return false}for(;p<m;++p){n=o[p];q=n._cbr||n._mbr||n;if(!n){continue}h=n[0];if(!w[h]&&this[0]!==h&&n.__c[s]&&u(q,j)){w[h]=n}}for(v in w){n=w[v];if(r&&"map" in n){var t=this._SAT(this.map,n.map);t.obj=n;t.type="SAT";if(t){k.push(t)}}else{k.push({obj:n,type:"MBR"})}}if(!k.length){return false}return k},onHit:function(i,k,j){var h=false;this.bind("EnterFrame",function(){var l=this.hit(i);if(l){h=true;k.call(this,l)}else{if(h){if(typeof j=="function"){j.call(this)}h=false}}});return this},_createCollisionHandler:function(h,i){return function(){var j=this.hit(h);if(i.occurring===true){if(j!==false){return}i.occurring=false;this.trigger("HitOff",h)}else{if(j!==false){i.occurring=true;this.trigger("HitOn",j)}}}},checkHits:function(){var k=arguments;var j=0;if(k.length===1){k=k[0].split(/\s*,\s*/)}for(;j<k.length;++j){var h=k[j];var l=this._collisionData[h];if(l!==undefined){continue}this._collisionData[h]=l={occurring:false,handler:null};l.handler=this._createCollisionHandler(h,l);this.bind("EnterFrame",l.handler)}return this},ignoreHits:function(){var k=arguments;var j=0;var l;if(k.length===0){for(l in this._collisionData){this.unbind("EnterFrame",l.handler)}this._collisionData={}}if(k.length===1){k=k[0].split(/\s*,\s*/)}for(;j<k.length;++j){var h=k[j];l=this._collisionData[h];if(l===undefined){continue}this.unbind("EnterFrame",l.handler);delete this._collisionData[h]}return this},resetHitChecks:function(){var k=arguments;var j=0;var l;if(k.length===0){for(l in this._collisionData){this._collisionData[l].occurring=false}}if(k.length===1){k=k[0].split(/\s*,\s*/)}for(;j<k.length;++j){var h=k[j];l=this._collisionData[h];if(l===undefined){continue}l.occurring=false}return this},_SAT:function(p,o){var A=0,C=p.points,B=o.points,w=C.length/2,z,y=B.length/2,F=0,D=0,m,x,u,v,t,E,n=-Infinity,r=null,q=null,s,h;for(;A<w;A++){h=(A==w-1?0:A+1);F=-(C[2*A+1]-C[2*h+1]);D=(C[2*A]-C[2*h]);m=Math.sqrt(F*F+D*D);F/=m;D/=m;x=u=Infinity;v=t=-Infinity;for(z=0;z<w;++z){s=C[2*z]*F+C[2*z+1]*D;if(s>v){v=s}if(s<x){x=s}}for(z=0;z<y;++z){s=B[2*z]*F+B[2*z+1]*D;if(s>t){t=s}if(s<u){u=s}}if(x<u){E=u-v;F=-F;D=-D}else{E=x-t}if(E>=0){return false}if(E>n){n=E;r=F;q=D}}for(A=0;A<y;A++){h=(A==y-1?0:A+1);F=-(B[2*A+1]-B[2*h+1]);D=(B[2*A]-B[2*h]);m=Math.sqrt(F*F+D*D);F/=m;D/=m;x=u=Infinity;v=t=-Infinity;for(z=0;z<w;++z){s=C[2*z]*F+C[2*z+1]*D;if(s>v){v=s}if(s<x){x=s}}for(z=0;z<y;++z){s=B[2*z]*F+B[2*z+1]*D;if(s>t){t=s}if(s<u){u=s}}if(x<u){E=u-v;F=-F;D=-D}else{E=x-t}if(E>=0){return false}if(E>n){n=E;r=F;q=D}}return{overlap:n,normal:{x:r,y:q}}}})},{"../core/core.js":7}],41:[function(b,d,a){var f=b("../core/core.js");f.math={abs:function(g){return g<0?-g:g},amountOf:function(g,h,i){if(h<i){return(g-h)/(i-h)}else{return(g-i)/(h-i)}},clamp:function(i,h,g){if(i>g){return g}else{if(i<h){return h}else{return i}}},degToRad:function(g){return g*Math.PI/180},distance:function(i,k,h,j){var g=f.math.squaredDistance(i,k,h,j);return Math.sqrt(parseFloat(g))},lerp:function(h,g,i){return h+(g-h)*i},negate:function(g){if(Math.random()<g){return -1}else{return 1}},radToDeg:function(g){return g*180/Math.PI},randomElementOfArray:function(g){return g[Math.floor(g.length*Math.random())]},randomInt:function(h,g){return h+Math.floor((1+g-h)*Math.random())},randomNumber:function(h,g){return h+(g-h)*Math.random()},squaredDistance:function(h,j,g,i){return(h-g)*(h-g)+(j-i)*(j-i)},withinRange:function(i,h,g){return(i>=h&&i<=g)}};f.math.Vector2D=(function(){function g(h,i){if(h instanceof g){this.x=h.x;this.y=h.y}else{if(arguments.length===2){this.x=h;this.y=i}else{if(arguments.length>0){throw"Unexpected number of arguments for Vector2D()"}}}}g.prototype.x=0;g.prototype.y=0;g.prototype.add=function(h){this.x+=h.x;this.y+=h.y;return this};g.prototype.angleBetween=function(h){return Math.atan2(this.x*h.y-this.y*h.x,this.x*h.x+this.y*h.y)};g.prototype.angleTo=function(h){return Math.atan2(h.y-this.y,h.x-this.x)};g.prototype.clone=function(){return new g(this)};g.prototype.distance=function(h){return Math.sqrt((h.x-this.x)*(h.x-this.x)+(h.y-this.y)*(h.y-this.y))};g.prototype.distanceSq=function(h){return(h.x-this.x)*(h.x-this.x)+(h.y-this.y)*(h.y-this.y)};g.prototype.divide=function(h){this.x/=h.x;this.y/=h.y;return this};g.prototype.dotProduct=function(h){return this.x*h.x+this.y*h.y};g.prototype.crossProduct=function(h){return this.x*h.y-this.y*h.x};g.prototype.equals=function(h){return h instanceof g&&this.x==h.x&&this.y==h.y};g.prototype.perpendicular=function(h){h=h||new g();return h.setValues(-this.y,this.x)};g.prototype.getNormal=function(i,h){h=h||new g();return h.setValues(i.y-this.y,this.x-i.x).normalize()};g.prototype.isZero=function(){return this.x===0&&this.y===0};g.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};g.prototype.magnitudeSq=function(){return this.x*this.x+this.y*this.y};g.prototype.multiply=function(h){this.x*=h.x;this.y*=h.y;return this};g.prototype.negate=function(){this.x=-this.x;this.y=-this.y;return this};g.prototype.normalize=function(){var h=Math.sqrt(this.x*this.x+this.y*this.y);if(h===0){this.x=1;this.y=0}else{this.x/=h;this.y/=h}return this};g.prototype.scale=function(i,h){if(h===undefined){h=i}this.x*=i;this.y*=h;return this};g.prototype.scaleToMagnitude=function(i){var h=i/this.magnitude();this.x*=h;this.y*=h;return this};g.prototype.setValues=function(h,i){if(h instanceof g){this.x=h.x;this.y=h.y}else{this.x=h;this.y=i}return this};g.prototype.subtract=function(h){this.x-=h.x;this.y-=h.y;return this};g.prototype.toString=function(){return"Vector2D("+this.x+", "+this.y+")"};g.prototype.translate=function(i,h){if(h===undefined){h=i}this.x+=i;this.y+=h;return this};g.tripleProduct=function(j,i,m,h){h=h||new f.math.Vector2D();var k=j.dotProduct(m);var l=i.dotProduct(m);return h.setValues(i.x*k-j.x*l,i.y*k-j.y*l)};return g})();f.math.Matrix2D=(function(){Matrix2D=function(h,g,l,k,j,i){if(h instanceof Matrix2D){this.a=h.a;this.b=h.b;this.c=h.c;this.d=h.d;this.e=h.e;this.f=h.f}else{if(arguments.length===6){this.a=h;this.b=g;this.c=l;this.d=k;this.e=j;this.f=i}else{if(arguments.length>0){throw"Unexpected number of arguments for Matrix2D()"}}}};Matrix2D.prototype.a=1;Matrix2D.prototype.b=0;Matrix2D.prototype.c=0;Matrix2D.prototype.d=1;Matrix2D.prototype.e=0;Matrix2D.prototype.f=0;Matrix2D.prototype.apply=function(h){var g=h.x;h.x=g*this.a+h.y*this.c+this.e;h.y=g*this.b+h.y*this.d+this.f;return h};Matrix2D.prototype.clone=function(){return new Matrix2D(this)};Matrix2D.prototype.combine=function(g){var h=this.a;this.a=h*g.a+this.b*g.c;this.b=h*g.b+this.b*g.d;h=this.c;this.c=h*g.a+this.d*g.c;this.d=h*g.b+this.d*g.d;h=this.e;this.e=h*g.a+this.f*g.c+g.e;this.f=h*g.b+this.f*g.d+g.f;return this};Matrix2D.prototype.equals=function(g){return g instanceof Matrix2D&&this.a==g.a&&this.b==g.b&&this.c==g.c&&this.d==g.d&&this.e==g.e&&this.f==g.f};Matrix2D.prototype.determinant=function(){return this.a*this.d-this.b*this.c};Matrix2D.prototype.invert=function(){var h=this.determinant();if(h!==0){var g={a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f};this.a=g.d/h;this.b=-g.b/h;this.c=-g.c/h;this.d=g.a/h;this.e=(g.c*g.f-g.e*g.d)/h;this.f=(g.e*g.b-g.a*g.f)/h}return this};Matrix2D.prototype.isIdentity=function(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.e===0&&this.f===0};Matrix2D.prototype.isInvertible=function(){return this.determinant()!==0};Matrix2D.prototype.preRotate=function(h){var g=Math.cos(h);var j=Math.sin(h);var i=this.a;this.a=g*i-j*this.b;this.b=j*i+g*this.b;i=this.c;this.c=g*i-j*this.d;this.d=j*i+g*this.d;return this};Matrix2D.prototype.preScale=function(h,g){if(g===undefined){g=h}this.a*=h;this.b*=g;this.c*=h;this.d*=g;return this};Matrix2D.prototype.preTranslate=function(h,g){if(typeof h==="number"){this.e+=h;this.f+=g}else{this.e+=h.x;this.f+=h.y}return this};Matrix2D.prototype.rotate=function(h){var g=Math.cos(h);var j=Math.sin(h);var i=this.a;this.a=g*i-j*this.b;this.b=j*i+g*this.b;i=this.c;this.c=g*i-j*this.d;this.d=j*i+g*this.d;i=this.e;this.e=g*i-j*this.f;this.f=j*i+g*this.f;return this};Matrix2D.prototype.scale=function(h,g){if(g===undefined){g=h}this.a*=h;this.b*=g;this.c*=h;this.d*=g;this.e*=h;this.f*=g;return this};Matrix2D.prototype.setValues=function(h,g,l,k,j,i){if(h instanceof Matrix2D){this.a=h.a;this.b=h.b;this.c=h.c;this.d=h.d;this.e=h.e;this.f=h.f}else{this.a=h;this.b=g;this.c=l;this.d=k;this.e=j;this.f=i}return this};Matrix2D.prototype.toString=function(){return"Matrix2D(["+this.a+", "+this.c+", "+this.e+"] ["+this.b+", "+this.d+", "+this.f+"] [0, 0, 1])"};Matrix2D.prototype.translate=function(h,g){if(typeof h==="number"){this.e+=this.a*h+this.c*g;this.f+=this.b*h+this.d*g}else{this.e+=this.a*h.x+this.c*h.y;this.f+=this.b*h.x+this.d*h.y}return this};return Matrix2D})()},{"../core/core.js":7}],42:[function(b,d,a){var f=b("../core/core.js");f.extend({rectManager:{merge:function(h,g,i){if(typeof i==="undefined"){i={}}i._h=Math.max(h._y+h._h,g._y+g._h);i._w=Math.max(h._x+h._w,g._x+g._w);i._x=Math.min(h._x,g._x);i._y=Math.min(h._y,g._y);i._w-=i._x;i._h-=i._y;return i},overlap:function(h,g){return(h._x<g._x+g._w&&h._x+h._w>g._x&&h._y<g._y+g._h&&h._y+h._h>g._y)},mergeSet:function(h){var g=0;while(g<h.length-1){if(this.overlap(h[g],h[g+1])){this.merge(h[g],h[g+1],h[g]);h.splice(g+1,1);if(g>0){g--}}else{g++}}return h},boundingRect:function(o){if(!o||!o.length){return}var n=[],j=1,g=o.length,m,k=o[0],h;k=[k._x,k._y,k._x+k._w,k._y+k._h];while(j<g){m=o[j];h=[m._x,m._y,m._x+m._w,m._y+m._h];if(h[0]<k[0]){k[0]=h[0]}if(h[1]<k[1]){k[1]=h[1]}if(h[2]>k[2]){k[2]=h[2]}if(h[3]>k[3]){k[3]=h[3]}j++}h=k;k={_x:h[0],_y:h[1],_w:h[2]-h[0],_h:h[3]-h[1]};return k},_pool:(function(){var g=[],h=0;return{get:function(i,m,j,k){if(g.length<=h){g.push({})}var l=g[h++];l._x=i;l._y=m;l._w=j;l._h=k;return l},copy:function(j){if(g.length<=h){g.push({})}var i=g[h++];i._x=j._x;i._y=j._y;i._w=j._w;i._h=j._h;return i},recycle:function(i){h--}}})(),}})},{"../core/core.js":7}],43:[function(b,a,d){var i=b("../core/core.js");var j,k=function(l){j=l||64;this.map={}},h=" ",f={};k.prototype={insert:function(q){var o=k.key(q),n=new g(o,q,this),m=0,l,p;for(m=o.x1;m<=o.x2;m++){for(l=o.y1;l<=o.y2;l++){p=(m<<16)^l;if(!this.map[p]){this.map[p]=[]}this.map[p].push(q)}}return n},search:function(v,n){var x=k.key(v,f),u,r,q,p,w,t=[];if(n===undefined){n=true}for(u=x.x1;u<=x.x2;u++){for(r=x.y1;r<=x.y2;r++){w=this.map[(u<<16)^r];if(w){for(q=0;q<w.length;q++){t.push(w[q])}}}}if(n){var s,m,o=[],y={};for(u=0,p=t.length;u<p;u++){s=t[u];if(!s){continue}m=s[0];s=s._mbr||s;if(!y[m]&&s._x<v._x+v._w&&s._x+s._w>v._x&&s._y<v._y+v._h&&s._y+s._h>v._y){y[m]=t[u]}}for(s in y){o.push(y[s])}return o}else{return t}},remove:function(r,t){var q=0,p,s;if(arguments.length==1){t=r;r=k.key(t,f)}for(q=r.x1;q<=r.x2;q++){for(p=r.y1;p<=r.y2;p++){s=(q<<16)^p;if(this.map[s]){var o=this.map[s],l,u=o.length;for(l=0;l<u;l++){if(o[l]&&o[l][0]===t[0]){o.splice(l,1)}}}}}},refresh:function(s){var r=s.keys;var t=s.obj;var o,q,p,l,u;for(q=r.x1;q<=r.x2;q++){for(p=r.y1;p<=r.y2;p++){o=this.map[(q<<16)^p];if(o){u=o.length;for(l=0;l<u;l++){if(o[l]&&o[l][0]===t[0]){o.splice(l,1)}}}}}k.key(t,r);for(q=r.x1;q<=r.x2;q++){for(p=r.y1;p<=r.y2;p++){o=this.map[(q<<16)^p];if(!o){o=this.map[(q<<16)^p]=[]}o.push(t)}}return s},boundaries:function(){var l,q,r={max:{x:-Infinity,y:-Infinity},min:{x:Infinity,y:Infinity}},p={max:{x:-Infinity,y:-Infinity},min:{x:Infinity,y:Infinity}};for(var o in this.map){if(!this.map[o].length){continue}var n=o>>16,m=(o<<16)>>16;if(m<0){n=n^-1}if(n>=r.max.x){r.max.x=n;for(l in this.map[o]){q=this.map[o][l];if(typeof q=="object"&&"requires" in q){p.max.x=Math.max(p.max.x,q.x+q.w)}}}if(n<=r.min.x){r.min.x=n;for(l in this.map[o]){q=this.map[o][l];if(typeof q=="object"&&"requires" in q){p.min.x=Math.min(p.min.x,q.x)}}}if(m>=r.max.y){r.max.y=m;for(l in this.map[o]){q=this.map[o][l];if(typeof q=="object"&&"requires" in q){p.max.y=Math.max(p.max.y,q.y+q.h)}}}if(m<=r.min.y){r.min.y=m;for(l in this.map[o]){q=this.map[o][l];if(typeof q=="object"&&"requires" in q){p.min.y=Math.min(p.min.y,q.y)}}}}return p}};k.key=function(m,l){if(m._mbr){m=m._mbr}if(!l){l={}}l.x1=Math.floor(m._x/j);l.y1=Math.floor(m._y/j);l.x2=Math.floor((m._w+m._x)/j);l.y2=Math.floor((m._h+m._y)/j);return l};k.hash=function(l){return l.x1+h+l.y1+h+l.x2+h+l.y2};function g(l,n,m){this.keys=l;this.map=m;this.obj=n}g.prototype={update:function(l){if(k.hash(k.key(l,f))!=k.hash(this.keys)){this.map.refresh(this)}}};a.exports=k},{"../core/core.js":7}]},{},[17]);